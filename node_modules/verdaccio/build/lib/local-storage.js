"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _assert = _interopRequireDefault(require("assert"));
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _url = _interopRequireDefault(require("url"));
var _localStorage = _interopRequireDefault(require("@verdaccio/local-storage"));
var _streams = require("@verdaccio/streams");
var _utils = require("@verdaccio/utils");
var _pluginLoader = _interopRequireDefault(require("../lib/plugin-loader"));
var _constants = require("./constants");
var _storageUtils = require("./storage-utils");
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const debug = (0, _debug.default)('verdaccio:local-storage');
/**
 * Implements Storage interface (same for storage.js, local-storage.js, up-storage.js).
 */
class LocalStorage {
  constructor(config, logger) {
    _defineProperty(this, "config", void 0);
    _defineProperty(this, "storagePlugin", void 0);
    _defineProperty(this, "logger", void 0);
    this.logger = logger;
    this.config = config;
    this.storagePlugin = this._loadStorage(config, logger);
  }
  addPackage(name, pkg, callback) {
    const storage = this._getLocalStorage(name);
    if (_lodash.default.isNil(storage)) {
      return callback(_utils2.ErrorCode.getNotFound('this package cannot be added'));
    }
    storage.createPackage(name, (0, _storageUtils.generatePackageTemplate)(name), err => {
      // FIXME: it will be fixed here https://github.com/verdaccio/verdaccio/pull/1360
      // @ts-ignore
      if (_lodash.default.isNull(err) === false && (err.code === _constants.STORAGE.FILE_EXIST_ERROR || err.code === _constants.HTTP_STATUS.CONFLICT)) {
        return callback(_utils2.ErrorCode.getConflict());
      }
      const latest = (0, _utils.getLatestVersion)(pkg);
      if (_lodash.default.isNil(latest) === false && pkg.versions[latest]) {
        return callback(null, pkg.versions[latest]);
      }
      return callback();
    });
  }

  /**
   * Remove package.
   * @param {*} name
   * @param {*} callback
   * @return {Function}
   */
  removePackage(name, callback) {
    const storage = this._getLocalStorage(name);
    debug('[storage] removing package %o', name);
    if (_lodash.default.isNil(storage)) {
      return callback(_utils2.ErrorCode.getNotFound());
    }
    storage.readPackage(name, (err, data) => {
      if (_lodash.default.isNil(err) === false) {
        if (err.code === _constants.STORAGE.NO_SUCH_FILE_ERROR || err.code === _constants.HTTP_STATUS.NOT_FOUND) {
          return callback(_utils2.ErrorCode.getNotFound());
        }
        return callback(err);
      }
      data = (0, _storageUtils.normalizePackage)(data);
      this.storagePlugin.remove(name, removeFailed => {
        if (removeFailed) {
          // This will happen when database is locked
          this.logger.error({
            name
          }, `[storage/removePackage] the database is locked, removed has failed for @{name}`);
          return callback(_utils2.ErrorCode.getBadData(removeFailed.message));
        }
        storage.deletePackage(_constants.STORAGE.PACKAGE_FILE_NAME, err => {
          if (err) {
            return callback(err);
          }
          const attachments = Object.keys(data._attachments);
          this._deleteAttachments(storage, attachments, callback);
        });
      });
    });
  }

  /**
   * Synchronize remote package info with the local one
   * @param {*} name
   * @param {*} packageInfo
   * @param {*} callback
   */
  updateVersions(name, packageInfo, callback) {
    this._readCreatePackage(name, (err, packageLocalJson) => {
      if (err) {
        return callback(err);
      }
      let change = false;
      // updating readme
      packageLocalJson.readme = (0, _storageUtils.getLatestReadme)(packageInfo);
      if (packageInfo.readme !== packageLocalJson.readme) {
        change = true;
      }
      for (const versionId in packageInfo.versions) {
        if (_lodash.default.isNil(packageLocalJson.versions[versionId])) {
          let version = packageInfo.versions[versionId];

          // we don't keep readme for package versions,
          // only one readme per package
          version = (0, _storageUtils.cleanUpReadme)(version);
          version.contributors = (0, _utils.normalizeContributors)(version.contributors);
          change = true;
          packageLocalJson.versions[versionId] = version;
          if (version.dist && version.dist.tarball) {
            const urlObject = _url.default.parse(version.dist.tarball);
            const filename = urlObject.pathname.replace(/^.*\//, '');

            // we do NOT overwrite any existing records
            if (_lodash.default.isNil(packageLocalJson._distfiles[filename])) {
              const hash = packageLocalJson._distfiles[filename] = {
                url: version.dist.tarball,
                sha: version.dist.shasum
              };
              /* eslint spaced-comment: 0 */
              const upLink = version[Symbol.for('__verdaccio_uplink')];
              if (_lodash.default.isNil(upLink) === false) {
                this._updateUplinkToRemoteProtocol(hash, upLink);
              }
            }
          }
        }
      }
      for (const tag in packageInfo[_constants.DIST_TAGS]) {
        if (!packageLocalJson[_constants.DIST_TAGS][tag] || packageLocalJson[_constants.DIST_TAGS][tag] !== packageInfo[_constants.DIST_TAGS][tag]) {
          change = true;
          packageLocalJson[_constants.DIST_TAGS][tag] = packageInfo[_constants.DIST_TAGS][tag];
        }
      }
      for (const up in packageInfo._uplinks) {
        if (Object.prototype.hasOwnProperty.call(packageInfo._uplinks, up)) {
          const need_change = !(0, _utils2.isObject)(packageLocalJson._uplinks[up]) || packageInfo._uplinks[up].etag !== packageLocalJson._uplinks[up].etag || packageInfo._uplinks[up].fetched !== packageLocalJson._uplinks[up].fetched;
          if (need_change) {
            change = true;
            packageLocalJson._uplinks[up] = packageInfo._uplinks[up];
          }
        }
      }
      if ('time' in packageInfo && !_lodash.default.isEqual(packageLocalJson.time, packageInfo.time)) {
        packageLocalJson.time = packageInfo.time;
        change = true;
      }
      if (change) {
        debug('updating package %o info', name);
        this._writePackage(name, packageLocalJson, function (err) {
          callback(err, packageLocalJson);
        });
      } else {
        callback(null, packageLocalJson);
      }
    });
  }

  /**
   * Add a new version to a previous local package.
   * @param {*} name
   * @param {*} version
   * @param {*} metadata
   * @param {*} tag
   * @param {*} callback
   */
  addVersion(name, version, metadata, tag, callback) {
    this._updatePackage(name, (data, cb) => {
      // keep only one readme per package
      data.readme = metadata.readme;

      // TODO: lodash remove
      metadata = (0, _storageUtils.cleanUpReadme)(metadata);
      metadata.contributors = (0, _utils.normalizeContributors)(metadata.contributors);
      const hasVersion = data.versions[version] != null;
      if (hasVersion) {
        return cb(_utils2.ErrorCode.getConflict());
      }

      // if uploaded tarball has a different shasum, it's very likely that we have some kind of error
      if ((0, _utils2.isObject)(metadata.dist) && _lodash.default.isString(metadata.dist.tarball)) {
        const tarball = metadata.dist.tarball.replace(/.*\//, '');
        if ((0, _utils2.isObject)(data._attachments[tarball])) {
          if (_lodash.default.isNil(data._attachments[tarball].shasum) === false && _lodash.default.isNil(metadata.dist.shasum) === false) {
            if (data._attachments[tarball].shasum != metadata.dist.shasum) {
              const errorMessage = `shasum error, ${data._attachments[tarball].shasum} != ${metadata.dist.shasum}`;
              return cb(_utils2.ErrorCode.getBadRequest(errorMessage));
            }
          }
          const currentDate = new Date().toISOString();

          // some old storage do not have this field #740
          if (_lodash.default.isNil(data.time)) {
            data.time = {};
          }
          data.time['modified'] = currentDate;
          if ('created' in data.time === false) {
            data.time.created = currentDate;
          }
          data.time[version] = currentDate;
          data._attachments[tarball].version = version;
        }
      }
      data.versions[version] = metadata;
      (0, _utils2.tagVersion)(data, version, tag);
      this.storagePlugin.add(name, addFailed => {
        if (addFailed) {
          return cb(_utils2.ErrorCode.getBadData(addFailed.message));
        }
        cb();
      });
    }, callback);
  }

  /**
   * Merge a new list of tags for a local packages with the existing one.
   * @param {*} pkgName
   * @param {*} tags
   * @param {*} callback
   */
  mergeTags(pkgName, tags, callback) {
    this._updatePackage(pkgName, (data, cb) => {
      /* eslint guard-for-in: 0 */
      for (const tag in tags) {
        // this handle dist-tag rm command
        if (_lodash.default.isNull(tags[tag])) {
          delete data[_constants.DIST_TAGS][tag];
          continue;
        }
        if (_lodash.default.isNil(data.versions[tags[tag]])) {
          return cb(this._getVersionNotFound());
        }
        const version = tags[tag];
        (0, _utils2.tagVersion)(data, version, tag);
      }
      cb(null);
    }, callback);
  }

  /**
   * Return version not found
   * @return {String}
   * @private
   */
  _getVersionNotFound() {
    return _utils2.ErrorCode.getNotFound(_constants.API_ERROR.VERSION_NOT_EXIST);
  }

  /**
   * Return file no available
   * @return {String}
   * @private
   */
  _getFileNotAvailable() {
    return _utils2.ErrorCode.getNotFound('no such file available');
  }

  /**
   * Update the package metadata, tags and attachments (tarballs).
   * Note: Currently supports unpublishing and deprecation.
   * @param {*} name
   * @param {*} incomingPkg
   * @param {*} revision
   * @param {*} callback
   * @return {Function}
   */
  changePackage(name, incomingPkg, revision, callback) {
    if (!(0, _utils2.isObject)(incomingPkg.versions) || !(0, _utils2.isObject)(incomingPkg[_constants.DIST_TAGS])) {
      this.logger.error({
        name
      }, `changePackage bad data for @{name}`);
      return callback(_utils2.ErrorCode.getBadData());
    }
    debug('changePackage udapting package for %o', name);
    this._updatePackage(name, (localData, cb) => {
      for (const version in localData.versions) {
        const incomingVersion = incomingPkg.versions[version];
        if (_lodash.default.isNil(incomingVersion)) {
          this.logger.info({
            name: name,
            version: version
          }, 'unpublishing @{name}@@{version}');

          // FIXME: I prefer return a new object rather mutate the metadata
          delete localData.versions[version];
          delete localData.time[version];
          for (const file in localData._attachments) {
            if (localData._attachments[file].version === version) {
              delete localData._attachments[file].version;
            }
          }
        } else if (Object.prototype.hasOwnProperty.call(incomingVersion, 'deprecated')) {
          const incomingDeprecated = incomingVersion.deprecated;
          if (incomingDeprecated != localData.versions[version].deprecated) {
            if (!incomingDeprecated) {
              this.logger.info({
                name: name,
                version: version
              }, 'undeprecating @{name}@@{version}');
              delete localData.versions[version].deprecated;
            } else {
              this.logger.info({
                name: name,
                version: version
              }, 'deprecating @{name}@@{version}');
              localData.versions[version].deprecated = incomingDeprecated;
            }
            localData.time.modified = new Date().toISOString();
          }
        }
      }
      localData[_constants.USERS] = incomingPkg[_constants.USERS];
      localData[_constants.DIST_TAGS] = incomingPkg[_constants.DIST_TAGS];
      cb(null);
    }, function (err) {
      if (err) {
        return callback(err);
      }
      callback();
    });
  }
  /**
   * Remove a tarball.
   * @param {*} name
   * @param {*} filename
   * @param {*} revision
   * @param {*} callback
   */
  removeTarball(name, filename, revision, callback) {
    (0, _assert.default)((0, _utils.validateName)(filename));
    this._updatePackage(name, (data, cb) => {
      if (data._attachments[filename]) {
        delete data._attachments[filename];
        cb(null);
      } else {
        cb(this._getFileNotAvailable());
      }
    }, err => {
      if (err) {
        return callback(err);
      }
      const storage = this._getLocalStorage(name);
      if (storage) {
        storage.deletePackage(filename, callback);
      }
    });
  }

  /**
   * Add a tarball.
   * @param {String} name
   * @param {String} filename
   * @return {Stream}
   */
  addTarball(name, filename) {
    (0, _assert.default)((0, _utils.validateName)(filename));
    let length = 0;
    const shaOneHash = (0, _utils.createTarballHash)();
    const uploadStream = new _streams.UploadTarball({});
    const _transform = uploadStream._transform;
    const storage = this._getLocalStorage(name);
    uploadStream.abort = function () {};
    uploadStream.done = function () {};
    uploadStream._transform = function (data, ...args) {
      shaOneHash.update(data);
      // measure the length for validation reasons
      length += data.length;
      const appliedData = [data, ...args];
      // FIXME: not sure about this approach, tsc complains
      // @ts-ignore
      _transform.apply(uploadStream, appliedData);
    };
    if (name === '__proto__') {
      process.nextTick(() => {
        uploadStream.emit('error', _utils2.ErrorCode.getForbidden());
      });
      return uploadStream;
    }
    if (!storage) {
      process.nextTick(() => {
        uploadStream.emit('error', "can't upload this package");
      });
      return uploadStream;
    }
    const writeStream = storage.writeTarball(filename);
    writeStream.on('error', err => {
      // @ts-ignore
      if (err.code === _constants.STORAGE.FILE_EXIST_ERROR || err.code === _constants.HTTP_STATUS.CONFLICT) {
        uploadStream.emit('error', _utils2.ErrorCode.getConflict());
        uploadStream.abort();
        // @ts-ignore
      } else if (err.code === _constants.STORAGE.NO_SUCH_FILE_ERROR || err.code === _constants.HTTP_STATUS.NOT_FOUND) {
        // check if package exists to throw an appropriate message
        this.getPackageMetadata(name, function (_err, _res) {
          if (_err) {
            uploadStream.emit('error', _err);
          } else {
            uploadStream.emit('error', err);
          }
        });
      } else {
        uploadStream.emit('error', err);
      }
    });
    writeStream.on('open', function () {
      // re-emitting open because it's handled in storage.js
      uploadStream.emit('open');
    });
    writeStream.on('success', () => {
      this._updatePackage(name, function updater(data, cb) {
        data._attachments[filename] = {
          shasum: shaOneHash.digest('hex')
        };
        cb(null);
      }, function (err) {
        if (err) {
          uploadStream.emit('error', err);
        } else {
          uploadStream.emit('success');
        }
      });
    });
    uploadStream.abort = function () {
      writeStream.abort();
    };
    uploadStream.done = function () {
      if (!length) {
        uploadStream.emit('error', _utils2.ErrorCode.getBadData('refusing to accept zero-length file'));
        writeStream.abort();
      } else {
        writeStream.done();
      }
    };
    uploadStream.pipe(writeStream);
    return uploadStream;
  }

  /**
   * Get a tarball.
   * @param {*} name
   * @param {*} filename
   * @return {ReadTarball}
   */
  getTarball(name, filename) {
    (0, _assert.default)((0, _utils.validateName)(filename));
    const storage = this._getLocalStorage(name);
    if (_lodash.default.isNil(storage)) {
      return this._createFailureStreamResponse();
    }
    return this._streamSuccessReadTarBall(storage, filename);
  }

  /**
   * Return a stream that emits a read failure.
   * @private
   * @return {ReadTarball}
   */
  _createFailureStreamResponse() {
    const stream = new _streams.ReadTarball({});
    process.nextTick(() => {
      stream.emit('error', this._getFileNotAvailable());
    });
    return stream;
  }

  /**
   * Return a stream that emits the tarball data
   * @param {Object} storage
   * @param {String} filename
   * @private
   * @return {ReadTarball}
   */
  _streamSuccessReadTarBall(storage, filename) {
    const stream = new _streams.ReadTarball({});
    const readTarballStream = storage.readTarball(filename);
    const e404 = _utils2.ErrorCode.getNotFound;
    stream.abort = function () {
      if (_lodash.default.isNil(readTarballStream) === false) {
        readTarballStream.abort();
      }
    };
    readTarballStream.on('error', function (err) {
      // @ts-ignore
      if (err.code === _constants.STORAGE.NO_SUCH_FILE_ERROR || err.code === _constants.HTTP_STATUS.NOT_FOUND) {
        stream.emit('error', e404('no such file available'));
      } else {
        stream.emit('error', err);
      }
    });
    readTarballStream.on('content-length', function (content) {
      stream.emit('content-length', content);
    });
    readTarballStream.on('open', function () {
      // re-emitting open because it's handled in storage.js
      stream.emit('open');
      readTarballStream.pipe(stream);
    });
    return stream;
  }

  /**
   * Retrieve a package by name.
   * @param {*} name
   * @param {*} callback
   * @return {Function}
   */
  getPackageMetadata(name, callback = () => {}) {
    const storage = this._getLocalStorage(name);
    if (_lodash.default.isNil(storage)) {
      return callback(_utils2.ErrorCode.getNotFound());
    }
    this._readPackage(name, storage, callback);
  }

  /**
   * Search a local package.
   * @param {*} startKey
   * @param {*} options
   * @return {Function}
   */
  search(startKey, options) {
    const stream = new _streams.ReadTarball({
      objectMode: true
    });
    this._searchEachPackage((item, cb) => {
      // @ts-ignore
      if (item.time > parseInt(startKey, 10)) {
        this.getPackageMetadata(item.name, (err, data) => {
          if (err) {
            return cb(err);
          }

          // @ts-ignore
          const time = new Date(item.time).toISOString();
          const result = (0, _storageUtils.prepareSearchPackage)(data, time);
          if (_lodash.default.isNil(result) === false) {
            stream.push(result);
          }
          cb(null);
        });
      } else {
        cb(null);
      }
    }, function onEnd(err) {
      if (err) {
        stream.emit('error', err);
        return;
      }
      stream.end();
    });
    return stream;
  }

  /**
   * Retrieve a wrapper that provide access to the package location.
   * @param {Object} pkgName package name.
   * @return {Object}
   */
  _getLocalStorage(pkgName) {
    return this.storagePlugin.getPackageStorage(pkgName);
  }

  /**
   * Read a json file from storage.
   * @param {Object} storage
   * @param {Function} callback
   */
  _readPackage(name, storage, callback) {
    storage.readPackage(name, (err, result) => {
      if (err) {
        if (err.code === _constants.STORAGE.NO_SUCH_FILE_ERROR || err.code === _constants.HTTP_STATUS.NOT_FOUND) {
          return callback(_utils2.ErrorCode.getNotFound());
        }
        return callback(this._internalError(err, _constants.STORAGE.PACKAGE_FILE_NAME, 'error reading'));
      }
      callback(err, (0, _storageUtils.normalizePackage)(result));
    });
  }

  /**
   * Walks through each package and calls `on_package` on them.
   * @param {*} onPackage
   * @param {*} onEnd
   */
  _searchEachPackage(onPackage, onEnd) {
    // save wait whether plugin still do not support search functionality
    if (_lodash.default.isNil(this.storagePlugin.search)) {
      this.logger.warn('plugin search not implemented yet');
      onEnd();
    } else {
      this.storagePlugin.search(onPackage, onEnd, _utils.validateName);
    }
  }

  /**
   * Retrieve either a previous created local package or a boilerplate.
   * @param {*} pkgName
   * @param {*} callback
   * @return {Function}
   */
  _readCreatePackage(pkgName, callback) {
    const storage = this._getLocalStorage(pkgName);
    if (_lodash.default.isNil(storage)) {
      this._createNewPackage(pkgName, callback);
      return;
    }
    storage.readPackage(pkgName, (err, data) => {
      // TODO: race condition
      if (_lodash.default.isNil(err) === false) {
        if (err.code === _constants.STORAGE.NO_SUCH_FILE_ERROR || err.code === _constants.HTTP_STATUS.NOT_FOUND) {
          data = (0, _storageUtils.generatePackageTemplate)(pkgName);
        } else {
          return callback(this._internalError(err, _constants.STORAGE.PACKAGE_FILE_NAME, 'error reading'));
        }
      }
      callback(null, (0, _storageUtils.normalizePackage)(data));
    });
  }
  _createNewPackage(name, callback) {
    return callback(null, (0, _storageUtils.normalizePackage)((0, _storageUtils.generatePackageTemplate)(name)));
  }

  /**
   * Handle internal error
   * @param {*} err
   * @param {*} file
   * @param {*} message
   * @return {Object} Error instance
   */
  _internalError(err, file, message) {
    this.logger.error({
      err: err,
      file: file
    }, `${message}  @{file}: @{!err.message}`);
    return _utils2.ErrorCode.getInternalError();
  }

  /**
   * @param {*} name package name
   * @param {*} updateHandler function(package, cb) - update function
   * @param {*} callback callback that gets invoked after it's all updated
   * @return {Function}
   */
  _updatePackage(name, updateHandler, callback) {
    const storage = this._getLocalStorage(name);
    if (!storage) {
      return callback(_utils2.ErrorCode.getNotFound());
    }
    storage.updatePackage(name, updateHandler, this._writePackage.bind(this), _storageUtils.normalizePackage, callback);
  }

  /**
   * Update the revision (_rev) string for a package.
   * @param {*} name
   * @param {*} json
   * @param {*} callback
   * @return {Function}
   */
  _writePackage(name, json, callback) {
    const storage = this._getLocalStorage(name);
    if (_lodash.default.isNil(storage)) {
      return callback();
    }
    storage.savePackage(name, this._setDefaultRevision(json), callback);
  }
  _setDefaultRevision(json) {
    // calculate revision from couch db
    if (_lodash.default.isString(json._rev) === false) {
      json._rev = _constants.STORAGE.DEFAULT_REVISION;
    }

    // this is intended in debug mode we do not want modify the store revision
    if (_lodash.default.isNil(this.config._debug)) {
      json._rev = (0, _storageUtils.generateRevision)(json._rev);
    }
    return json;
  }
  _deleteAttachments(storage, attachments, callback) {
    debug('[storage/_deleteAttachments] delete attachments total: %o', attachments === null || attachments === void 0 ? void 0 : attachments.length);
    const unlinkNext = function (cb) {
      if (_lodash.default.isEmpty(attachments)) {
        return cb();
      }
      const attachment = attachments.shift();
      storage.deletePackage(attachment, function () {
        unlinkNext(cb);
      });
    };
    unlinkNext(function () {
      // try to unlink the directory, but ignore errors because it can fail
      storage.removePackage(function (err) {
        callback(err);
      });
    });
  }

  /**
   * Ensure the dist file remains as the same protocol
   * @param {Object} hash metadata
   * @param {String} upLinkKey registry key
   * @private
   */
  _updateUplinkToRemoteProtocol(hash, upLinkKey) {
    // if we got this information from a known registry,
    // use the same protocol for the tarball
    //
    // see https://github.com/rlidwka/sinopia/issues/166
    const tarballUrl = _url.default.parse(hash.url);
    const uplinkUrl = _url.default.parse(this.config.uplinks[upLinkKey].url);
    if (uplinkUrl.host === tarballUrl.host) {
      tarballUrl.protocol = uplinkUrl.protocol;
      hash.registry = upLinkKey;
      hash.url = _url.default.format(tarballUrl);
    }
  }
  async getSecret(config) {
    const secretKey = await this.storagePlugin.getSecret();
    return this.storagePlugin.setSecret(config.checkSecretKey(secretKey));
  }
  _loadStorage(config, logger) {
    const Storage = this._loadStorePlugin();
    if (_lodash.default.isNil(Storage)) {
      (0, _assert.default)(this.config.storage, 'CONFIG: storage default path not defined');
      return new _localStorage.default(this.config, logger);
    }
    return Storage;
  }
  _loadStorePlugin() {
    const plugin_params = {
      config: this.config,
      logger: this.logger
    };

    // eslint-disable-next-line max-len
    const plugins = (0, _pluginLoader.default)(this.config, this.config.store, plugin_params, plugin => {
      return plugin.getPackageStorage;
    });
    return _lodash.default.head(plugins);
  }
  saveToken(token) {
    if (_lodash.default.isFunction(this.storagePlugin.saveToken) === false) {
      return Promise.reject(_utils2.ErrorCode.getCode(_constants.HTTP_STATUS.SERVICE_UNAVAILABLE, _constants.SUPPORT_ERRORS.PLUGIN_MISSING_INTERFACE));
    }
    return this.storagePlugin.saveToken(token);
  }
  deleteToken(user, tokenKey) {
    if (_lodash.default.isFunction(this.storagePlugin.deleteToken) === false) {
      return Promise.reject(_utils2.ErrorCode.getCode(_constants.HTTP_STATUS.SERVICE_UNAVAILABLE, _constants.SUPPORT_ERRORS.PLUGIN_MISSING_INTERFACE));
    }
    return this.storagePlugin.deleteToken(user, tokenKey);
  }
  readTokens(filter) {
    if (_lodash.default.isFunction(this.storagePlugin.readTokens) === false) {
      return Promise.reject(_utils2.ErrorCode.getCode(_constants.HTTP_STATUS.SERVICE_UNAVAILABLE, _constants.SUPPORT_ERRORS.PLUGIN_MISSING_INTERFACE));
    }
    return this.storagePlugin.readTokens(filter);
  }
}
var _default = exports.default = LocalStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXNzZXJ0IiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZGVidWciLCJfbG9kYXNoIiwiX3VybCIsIl9sb2NhbFN0b3JhZ2UiLCJfc3RyZWFtcyIsIl91dGlscyIsIl9wbHVnaW5Mb2FkZXIiLCJfY29uc3RhbnRzIiwiX3N0b3JhZ2VVdGlscyIsIl91dGlsczIiLCJvYmoiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9kZWZpbmVQcm9wZXJ0eSIsImtleSIsInZhbHVlIiwiX3RvUHJvcGVydHlLZXkiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsImFyZyIsIl90b1ByaW1pdGl2ZSIsIlN0cmluZyIsImlucHV0IiwiaGludCIsInByaW0iLCJTeW1ib2wiLCJ0b1ByaW1pdGl2ZSIsInVuZGVmaW5lZCIsInJlcyIsImNhbGwiLCJUeXBlRXJyb3IiLCJOdW1iZXIiLCJkZWJ1ZyIsImJ1aWxEZWJ1ZyIsIkxvY2FsU3RvcmFnZSIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwibG9nZ2VyIiwic3RvcmFnZVBsdWdpbiIsIl9sb2FkU3RvcmFnZSIsImFkZFBhY2thZ2UiLCJuYW1lIiwicGtnIiwiY2FsbGJhY2siLCJzdG9yYWdlIiwiX2dldExvY2FsU3RvcmFnZSIsIl8iLCJpc05pbCIsIkVycm9yQ29kZSIsImdldE5vdEZvdW5kIiwiY3JlYXRlUGFja2FnZSIsImdlbmVyYXRlUGFja2FnZVRlbXBsYXRlIiwiZXJyIiwiaXNOdWxsIiwiY29kZSIsIlNUT1JBR0UiLCJGSUxFX0VYSVNUX0VSUk9SIiwiSFRUUF9TVEFUVVMiLCJDT05GTElDVCIsImdldENvbmZsaWN0IiwibGF0ZXN0IiwiZ2V0TGF0ZXN0VmVyc2lvbiIsInZlcnNpb25zIiwicmVtb3ZlUGFja2FnZSIsInJlYWRQYWNrYWdlIiwiZGF0YSIsIk5PX1NVQ0hfRklMRV9FUlJPUiIsIk5PVF9GT1VORCIsIm5vcm1hbGl6ZVBhY2thZ2UiLCJyZW1vdmUiLCJyZW1vdmVGYWlsZWQiLCJlcnJvciIsImdldEJhZERhdGEiLCJtZXNzYWdlIiwiZGVsZXRlUGFja2FnZSIsIlBBQ0tBR0VfRklMRV9OQU1FIiwiYXR0YWNobWVudHMiLCJrZXlzIiwiX2F0dGFjaG1lbnRzIiwiX2RlbGV0ZUF0dGFjaG1lbnRzIiwidXBkYXRlVmVyc2lvbnMiLCJwYWNrYWdlSW5mbyIsIl9yZWFkQ3JlYXRlUGFja2FnZSIsInBhY2thZ2VMb2NhbEpzb24iLCJjaGFuZ2UiLCJyZWFkbWUiLCJnZXRMYXRlc3RSZWFkbWUiLCJ2ZXJzaW9uSWQiLCJ2ZXJzaW9uIiwiY2xlYW5VcFJlYWRtZSIsImNvbnRyaWJ1dG9ycyIsIm5vcm1hbGl6ZUNvbnRyaWJ1dG9ycyIsImRpc3QiLCJ0YXJiYWxsIiwidXJsT2JqZWN0IiwiVXJsTm9kZSIsInBhcnNlIiwiZmlsZW5hbWUiLCJwYXRobmFtZSIsInJlcGxhY2UiLCJfZGlzdGZpbGVzIiwiaGFzaCIsInVybCIsInNoYSIsInNoYXN1bSIsInVwTGluayIsImZvciIsIl91cGRhdGVVcGxpbmtUb1JlbW90ZVByb3RvY29sIiwidGFnIiwiRElTVF9UQUdTIiwidXAiLCJfdXBsaW5rcyIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwibmVlZF9jaGFuZ2UiLCJpc09iamVjdCIsImV0YWciLCJmZXRjaGVkIiwiaXNFcXVhbCIsInRpbWUiLCJfd3JpdGVQYWNrYWdlIiwiYWRkVmVyc2lvbiIsIm1ldGFkYXRhIiwiX3VwZGF0ZVBhY2thZ2UiLCJjYiIsImhhc1ZlcnNpb24iLCJpc1N0cmluZyIsImVycm9yTWVzc2FnZSIsImdldEJhZFJlcXVlc3QiLCJjdXJyZW50RGF0ZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImNyZWF0ZWQiLCJ0YWdWZXJzaW9uIiwiYWRkIiwiYWRkRmFpbGVkIiwibWVyZ2VUYWdzIiwicGtnTmFtZSIsInRhZ3MiLCJfZ2V0VmVyc2lvbk5vdEZvdW5kIiwiQVBJX0VSUk9SIiwiVkVSU0lPTl9OT1RfRVhJU1QiLCJfZ2V0RmlsZU5vdEF2YWlsYWJsZSIsImNoYW5nZVBhY2thZ2UiLCJpbmNvbWluZ1BrZyIsInJldmlzaW9uIiwibG9jYWxEYXRhIiwiaW5jb21pbmdWZXJzaW9uIiwiaW5mbyIsImZpbGUiLCJpbmNvbWluZ0RlcHJlY2F0ZWQiLCJkZXByZWNhdGVkIiwibW9kaWZpZWQiLCJVU0VSUyIsInJlbW92ZVRhcmJhbGwiLCJhc3NlcnQiLCJ2YWxpZGF0ZU5hbWUiLCJhZGRUYXJiYWxsIiwibGVuZ3RoIiwic2hhT25lSGFzaCIsImNyZWF0ZVRhcmJhbGxIYXNoIiwidXBsb2FkU3RyZWFtIiwiVXBsb2FkVGFyYmFsbCIsIl90cmFuc2Zvcm0iLCJhYm9ydCIsImRvbmUiLCJhcmdzIiwidXBkYXRlIiwiYXBwbGllZERhdGEiLCJhcHBseSIsInByb2Nlc3MiLCJuZXh0VGljayIsImVtaXQiLCJnZXRGb3JiaWRkZW4iLCJ3cml0ZVN0cmVhbSIsIndyaXRlVGFyYmFsbCIsIm9uIiwiZ2V0UGFja2FnZU1ldGFkYXRhIiwiX2VyciIsIl9yZXMiLCJ1cGRhdGVyIiwiZGlnZXN0IiwicGlwZSIsImdldFRhcmJhbGwiLCJfY3JlYXRlRmFpbHVyZVN0cmVhbVJlc3BvbnNlIiwiX3N0cmVhbVN1Y2Nlc3NSZWFkVGFyQmFsbCIsInN0cmVhbSIsIlJlYWRUYXJiYWxsIiwicmVhZFRhcmJhbGxTdHJlYW0iLCJyZWFkVGFyYmFsbCIsImU0MDQiLCJjb250ZW50IiwiX3JlYWRQYWNrYWdlIiwic2VhcmNoIiwic3RhcnRLZXkiLCJvcHRpb25zIiwib2JqZWN0TW9kZSIsIl9zZWFyY2hFYWNoUGFja2FnZSIsIml0ZW0iLCJwYXJzZUludCIsInJlc3VsdCIsInByZXBhcmVTZWFyY2hQYWNrYWdlIiwicHVzaCIsIm9uRW5kIiwiZW5kIiwiZ2V0UGFja2FnZVN0b3JhZ2UiLCJfaW50ZXJuYWxFcnJvciIsIm9uUGFja2FnZSIsIndhcm4iLCJfY3JlYXRlTmV3UGFja2FnZSIsImdldEludGVybmFsRXJyb3IiLCJ1cGRhdGVIYW5kbGVyIiwidXBkYXRlUGFja2FnZSIsImJpbmQiLCJqc29uIiwic2F2ZVBhY2thZ2UiLCJfc2V0RGVmYXVsdFJldmlzaW9uIiwiX3JldiIsIkRFRkFVTFRfUkVWSVNJT04iLCJnZW5lcmF0ZVJldmlzaW9uIiwidW5saW5rTmV4dCIsImlzRW1wdHkiLCJhdHRhY2htZW50Iiwic2hpZnQiLCJ1cExpbmtLZXkiLCJ0YXJiYWxsVXJsIiwidXBsaW5rVXJsIiwidXBsaW5rcyIsImhvc3QiLCJwcm90b2NvbCIsInJlZ2lzdHJ5IiwiZm9ybWF0IiwiZ2V0U2VjcmV0Iiwic2VjcmV0S2V5Iiwic2V0U2VjcmV0IiwiY2hlY2tTZWNyZXRLZXkiLCJTdG9yYWdlIiwiX2xvYWRTdG9yZVBsdWdpbiIsIkxvY2FsRGF0YWJhc2UiLCJwbHVnaW5fcGFyYW1zIiwicGx1Z2lucyIsImxvYWRQbHVnaW4iLCJzdG9yZSIsInBsdWdpbiIsImhlYWQiLCJzYXZlVG9rZW4iLCJ0b2tlbiIsImlzRnVuY3Rpb24iLCJQcm9taXNlIiwicmVqZWN0IiwiZ2V0Q29kZSIsIlNFUlZJQ0VfVU5BVkFJTEFCTEUiLCJTVVBQT1JUX0VSUk9SUyIsIlBMVUdJTl9NSVNTSU5HX0lOVEVSRkFDRSIsImRlbGV0ZVRva2VuIiwidXNlciIsInRva2VuS2V5IiwicmVhZFRva2VucyIsImZpbHRlciIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvbG9jYWwtc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQgYnVpbERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgVXJsTm9kZSBmcm9tICd1cmwnO1xuXG5pbXBvcnQgeyBwbHVnaW5VdGlscyB9IGZyb20gJ0B2ZXJkYWNjaW8vY29yZSc7XG5pbXBvcnQgTG9jYWxEYXRhYmFzZSBmcm9tICdAdmVyZGFjY2lvL2xvY2FsLXN0b3JhZ2UnO1xuaW1wb3J0IHsgUmVhZFRhcmJhbGwsIFVwbG9hZFRhcmJhbGwgfSBmcm9tICdAdmVyZGFjY2lvL3N0cmVhbXMnO1xuaW1wb3J0IHtcbiAgQXV0aG9yLFxuICBDYWxsYmFjayxcbiAgQ29uZmlnLFxuICBEaXN0RmlsZSxcbiAgTG9nZ2VyLFxuICBNZXJnZVRhZ3MsXG4gIFBhY2thZ2UsXG4gIFN0b3JhZ2VVcGRhdGVDYWxsYmFjayxcbiAgVG9rZW4sXG4gIFRva2VuRmlsdGVyLFxuICBWZXJzaW9uLFxuICBvbkVuZFNlYXJjaFBhY2thZ2UsXG4gIG9uU2VhcmNoUGFja2FnZSxcbn0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQge1xuICBjcmVhdGVUYXJiYWxsSGFzaCxcbiAgZ2V0TGF0ZXN0VmVyc2lvbixcbiAgbm9ybWFsaXplQ29udHJpYnV0b3JzLFxuICB2YWxpZGF0ZU5hbWUsXG59IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgeyBTdG9yYWdlUGx1Z2luTGVnYWN5IH0gZnJvbSAnLi4vLi4vdHlwZXMvY3VzdG9tJztcbmltcG9ydCBsb2FkUGx1Z2luIGZyb20gJy4uL2xpYi9wbHVnaW4tbG9hZGVyJztcbmltcG9ydCB7IFN0cmluZ1ZhbHVlIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgQVBJX0VSUk9SLCBESVNUX1RBR1MsIEhUVFBfU1RBVFVTLCBTVE9SQUdFLCBTVVBQT1JUX0VSUk9SUywgVVNFUlMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBjbGVhblVwUmVhZG1lLFxuICBnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZSxcbiAgZ2VuZXJhdGVSZXZpc2lvbixcbiAgZ2V0TGF0ZXN0UmVhZG1lLFxuICBub3JtYWxpemVQYWNrYWdlLFxufSBmcm9tICcuL3N0b3JhZ2UtdXRpbHMnO1xuaW1wb3J0IHsgcHJlcGFyZVNlYXJjaFBhY2thZ2UgfSBmcm9tICcuL3N0b3JhZ2UtdXRpbHMnO1xuaW1wb3J0IHsgRXJyb3JDb2RlLCBpc09iamVjdCwgdGFnVmVyc2lvbiB9IGZyb20gJy4vdXRpbHMnO1xuXG5jb25zdCBkZWJ1ZyA9IGJ1aWxEZWJ1ZygndmVyZGFjY2lvOmxvY2FsLXN0b3JhZ2UnKTtcbnR5cGUgU3RvcmFnZVBsdWdpbiA9IFN0b3JhZ2VQbHVnaW5MZWdhY3k8Q29uZmlnPiB8IGFueTtcbi8qKlxuICogSW1wbGVtZW50cyBTdG9yYWdlIGludGVyZmFjZSAoc2FtZSBmb3Igc3RvcmFnZS5qcywgbG9jYWwtc3RvcmFnZS5qcywgdXAtc3RvcmFnZS5qcykuXG4gKi9cbmNsYXNzIExvY2FsU3RvcmFnZSB7XG4gIHB1YmxpYyBjb25maWc6IENvbmZpZztcbiAgcHVibGljIHN0b3JhZ2VQbHVnaW46IFN0b3JhZ2VQbHVnaW47XG4gIHB1YmxpYyBsb2dnZXI6IExvZ2dlcjtcblxuICBwdWJsaWMgY29uc3RydWN0b3IoY29uZmlnOiBDb25maWcsIGxvZ2dlcjogTG9nZ2VyKSB7XG4gICAgdGhpcy5sb2dnZXIgPSBsb2dnZXI7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5zdG9yYWdlUGx1Z2luID0gdGhpcy5fbG9hZFN0b3JhZ2UoY29uZmlnLCBsb2dnZXIpO1xuICB9XG5cbiAgcHVibGljIGFkZFBhY2thZ2UobmFtZTogc3RyaW5nLCBwa2c6IFBhY2thZ2UsIGNhbGxiYWNrOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGNvbnN0IHN0b3JhZ2U6IGFueSA9IHRoaXMuX2dldExvY2FsU3RvcmFnZShuYW1lKTtcblxuICAgIGlmIChfLmlzTmlsKHN0b3JhZ2UpKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soRXJyb3JDb2RlLmdldE5vdEZvdW5kKCd0aGlzIHBhY2thZ2UgY2Fubm90IGJlIGFkZGVkJykpO1xuICAgIH1cblxuICAgIHN0b3JhZ2UuY3JlYXRlUGFja2FnZShuYW1lLCBnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZShuYW1lKSwgKGVycikgPT4ge1xuICAgICAgLy8gRklYTUU6IGl0IHdpbGwgYmUgZml4ZWQgaGVyZSBodHRwczovL2dpdGh1Yi5jb20vdmVyZGFjY2lvL3ZlcmRhY2Npby9wdWxsLzEzNjBcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGlmIChcbiAgICAgICAgXy5pc051bGwoZXJyKSA9PT0gZmFsc2UgJiZcbiAgICAgICAgKGVyci5jb2RlID09PSBTVE9SQUdFLkZJTEVfRVhJU1RfRVJST1IgfHwgZXJyLmNvZGUgPT09IEhUVFBfU1RBVFVTLkNPTkZMSUNUKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhFcnJvckNvZGUuZ2V0Q29uZmxpY3QoKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGxhdGVzdCA9IGdldExhdGVzdFZlcnNpb24ocGtnKTtcbiAgICAgIGlmIChfLmlzTmlsKGxhdGVzdCkgPT09IGZhbHNlICYmIHBrZy52ZXJzaW9uc1tsYXRlc3RdKSB7XG4gICAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBwa2cudmVyc2lvbnNbbGF0ZXN0XSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBwYWNrYWdlLlxuICAgKiBAcGFyYW0geyp9IG5hbWVcbiAgICogQHBhcmFtIHsqfSBjYWxsYmFja1xuICAgKiBAcmV0dXJuIHtGdW5jdGlvbn1cbiAgICovXG4gIHB1YmxpYyByZW1vdmVQYWNrYWdlKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZTogYW55ID0gdGhpcy5fZ2V0TG9jYWxTdG9yYWdlKG5hbWUpO1xuICAgIGRlYnVnKCdbc3RvcmFnZV0gcmVtb3ZpbmcgcGFja2FnZSAlbycsIG5hbWUpO1xuICAgIGlmIChfLmlzTmlsKHN0b3JhZ2UpKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soRXJyb3JDb2RlLmdldE5vdEZvdW5kKCkpO1xuICAgIH1cblxuICAgIHN0b3JhZ2UucmVhZFBhY2thZ2UobmFtZSwgKGVyciwgZGF0YTogUGFja2FnZSk6IHZvaWQgPT4ge1xuICAgICAgaWYgKF8uaXNOaWwoZXJyKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGVyci5jb2RlID09PSBTVE9SQUdFLk5PX1NVQ0hfRklMRV9FUlJPUiB8fCBlcnIuY29kZSA9PT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKEVycm9yQ29kZS5nZXROb3RGb3VuZCgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgZGF0YSA9IG5vcm1hbGl6ZVBhY2thZ2UoZGF0YSk7XG4gICAgICB0aGlzLnN0b3JhZ2VQbHVnaW4ucmVtb3ZlKG5hbWUsIChyZW1vdmVGYWlsZWQ6IEVycm9yKTogdm9pZCA9PiB7XG4gICAgICAgIGlmIChyZW1vdmVGYWlsZWQpIHtcbiAgICAgICAgICAvLyBUaGlzIHdpbGwgaGFwcGVuIHdoZW4gZGF0YWJhc2UgaXMgbG9ja2VkXG4gICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoXG4gICAgICAgICAgICB7IG5hbWUgfSxcbiAgICAgICAgICAgIGBbc3RvcmFnZS9yZW1vdmVQYWNrYWdlXSB0aGUgZGF0YWJhc2UgaXMgbG9ja2VkLCByZW1vdmVkIGhhcyBmYWlsZWQgZm9yIEB7bmFtZX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soRXJyb3JDb2RlLmdldEJhZERhdGEocmVtb3ZlRmFpbGVkLm1lc3NhZ2UpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHN0b3JhZ2UuZGVsZXRlUGFja2FnZShTVE9SQUdFLlBBQ0tBR0VfRklMRV9OQU1FLCAoZXJyKTogdm9pZCA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGF0dGFjaG1lbnRzID0gT2JqZWN0LmtleXMoZGF0YS5fYXR0YWNobWVudHMpO1xuXG4gICAgICAgICAgdGhpcy5fZGVsZXRlQXR0YWNobWVudHMoc3RvcmFnZSwgYXR0YWNobWVudHMsIGNhbGxiYWNrKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5jaHJvbml6ZSByZW1vdGUgcGFja2FnZSBpbmZvIHdpdGggdGhlIGxvY2FsIG9uZVxuICAgKiBAcGFyYW0geyp9IG5hbWVcbiAgICogQHBhcmFtIHsqfSBwYWNrYWdlSW5mb1xuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlVmVyc2lvbnMobmFtZTogc3RyaW5nLCBwYWNrYWdlSW5mbzogUGFja2FnZSwgY2FsbGJhY2s6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgdGhpcy5fcmVhZENyZWF0ZVBhY2thZ2UobmFtZSwgKGVyciwgcGFja2FnZUxvY2FsSnNvbik6IHZvaWQgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY2FsbGJhY2soZXJyKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGNoYW5nZSA9IGZhbHNlO1xuICAgICAgLy8gdXBkYXRpbmcgcmVhZG1lXG4gICAgICBwYWNrYWdlTG9jYWxKc29uLnJlYWRtZSA9IGdldExhdGVzdFJlYWRtZShwYWNrYWdlSW5mbyk7XG4gICAgICBpZiAocGFja2FnZUluZm8ucmVhZG1lICE9PSBwYWNrYWdlTG9jYWxKc29uLnJlYWRtZSkge1xuICAgICAgICBjaGFuZ2UgPSB0cnVlO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCB2ZXJzaW9uSWQgaW4gcGFja2FnZUluZm8udmVyc2lvbnMpIHtcbiAgICAgICAgaWYgKF8uaXNOaWwocGFja2FnZUxvY2FsSnNvbi52ZXJzaW9uc1t2ZXJzaW9uSWRdKSkge1xuICAgICAgICAgIGxldCB2ZXJzaW9uID0gcGFja2FnZUluZm8udmVyc2lvbnNbdmVyc2lvbklkXTtcblxuICAgICAgICAgIC8vIHdlIGRvbid0IGtlZXAgcmVhZG1lIGZvciBwYWNrYWdlIHZlcnNpb25zLFxuICAgICAgICAgIC8vIG9ubHkgb25lIHJlYWRtZSBwZXIgcGFja2FnZVxuICAgICAgICAgIHZlcnNpb24gPSBjbGVhblVwUmVhZG1lKHZlcnNpb24pO1xuICAgICAgICAgIHZlcnNpb24uY29udHJpYnV0b3JzID0gbm9ybWFsaXplQ29udHJpYnV0b3JzKHZlcnNpb24uY29udHJpYnV0b3JzIGFzIEF1dGhvcltdKTtcblxuICAgICAgICAgIGNoYW5nZSA9IHRydWU7XG4gICAgICAgICAgcGFja2FnZUxvY2FsSnNvbi52ZXJzaW9uc1t2ZXJzaW9uSWRdID0gdmVyc2lvbjtcblxuICAgICAgICAgIGlmICh2ZXJzaW9uLmRpc3QgJiYgdmVyc2lvbi5kaXN0LnRhcmJhbGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHVybE9iamVjdDogYW55ID0gVXJsTm9kZS5wYXJzZSh2ZXJzaW9uLmRpc3QudGFyYmFsbCk7XG4gICAgICAgICAgICBjb25zdCBmaWxlbmFtZSA9IHVybE9iamVjdC5wYXRobmFtZS5yZXBsYWNlKC9eLipcXC8vLCAnJyk7XG5cbiAgICAgICAgICAgIC8vIHdlIGRvIE5PVCBvdmVyd3JpdGUgYW55IGV4aXN0aW5nIHJlY29yZHNcbiAgICAgICAgICAgIGlmIChfLmlzTmlsKHBhY2thZ2VMb2NhbEpzb24uX2Rpc3RmaWxlc1tmaWxlbmFtZV0pKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGhhc2g6IERpc3RGaWxlID0gKHBhY2thZ2VMb2NhbEpzb24uX2Rpc3RmaWxlc1tmaWxlbmFtZV0gPSB7XG4gICAgICAgICAgICAgICAgdXJsOiB2ZXJzaW9uLmRpc3QudGFyYmFsbCxcbiAgICAgICAgICAgICAgICBzaGE6IHZlcnNpb24uZGlzdC5zaGFzdW0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAvKiBlc2xpbnQgc3BhY2VkLWNvbW1lbnQ6IDAgKi9cbiAgICAgICAgICAgICAgY29uc3QgdXBMaW5rOiBzdHJpbmcgPSB2ZXJzaW9uW1N5bWJvbC5mb3IoJ19fdmVyZGFjY2lvX3VwbGluaycpXTtcblxuICAgICAgICAgICAgICBpZiAoXy5pc05pbCh1cExpbmspID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZVVwbGlua1RvUmVtb3RlUHJvdG9jb2woaGFzaCwgdXBMaW5rKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IHRhZyBpbiBwYWNrYWdlSW5mb1tESVNUX1RBR1NdKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhcGFja2FnZUxvY2FsSnNvbltESVNUX1RBR1NdW3RhZ10gfHxcbiAgICAgICAgICBwYWNrYWdlTG9jYWxKc29uW0RJU1RfVEFHU11bdGFnXSAhPT0gcGFja2FnZUluZm9bRElTVF9UQUdTXVt0YWddXG4gICAgICAgICkge1xuICAgICAgICAgIGNoYW5nZSA9IHRydWU7XG4gICAgICAgICAgcGFja2FnZUxvY2FsSnNvbltESVNUX1RBR1NdW3RhZ10gPSBwYWNrYWdlSW5mb1tESVNUX1RBR1NdW3RhZ107XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yIChjb25zdCB1cCBpbiBwYWNrYWdlSW5mby5fdXBsaW5rcykge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHBhY2thZ2VJbmZvLl91cGxpbmtzLCB1cCkpIHtcbiAgICAgICAgICBjb25zdCBuZWVkX2NoYW5nZSA9XG4gICAgICAgICAgICAhaXNPYmplY3QocGFja2FnZUxvY2FsSnNvbi5fdXBsaW5rc1t1cF0pIHx8XG4gICAgICAgICAgICBwYWNrYWdlSW5mby5fdXBsaW5rc1t1cF0uZXRhZyAhPT0gcGFja2FnZUxvY2FsSnNvbi5fdXBsaW5rc1t1cF0uZXRhZyB8fFxuICAgICAgICAgICAgcGFja2FnZUluZm8uX3VwbGlua3NbdXBdLmZldGNoZWQgIT09IHBhY2thZ2VMb2NhbEpzb24uX3VwbGlua3NbdXBdLmZldGNoZWQ7XG5cbiAgICAgICAgICBpZiAobmVlZF9jaGFuZ2UpIHtcbiAgICAgICAgICAgIGNoYW5nZSA9IHRydWU7XG4gICAgICAgICAgICBwYWNrYWdlTG9jYWxKc29uLl91cGxpbmtzW3VwXSA9IHBhY2thZ2VJbmZvLl91cGxpbmtzW3VwXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCd0aW1lJyBpbiBwYWNrYWdlSW5mbyAmJiAhXy5pc0VxdWFsKHBhY2thZ2VMb2NhbEpzb24udGltZSwgcGFja2FnZUluZm8udGltZSkpIHtcbiAgICAgICAgcGFja2FnZUxvY2FsSnNvbi50aW1lID0gcGFja2FnZUluZm8udGltZTtcbiAgICAgICAgY2hhbmdlID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNoYW5nZSkge1xuICAgICAgICBkZWJ1ZygndXBkYXRpbmcgcGFja2FnZSAlbyBpbmZvJywgbmFtZSk7XG4gICAgICAgIHRoaXMuX3dyaXRlUGFja2FnZShuYW1lLCBwYWNrYWdlTG9jYWxKc29uLCBmdW5jdGlvbiAoZXJyKTogdm9pZCB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyLCBwYWNrYWdlTG9jYWxKc29uKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayhudWxsLCBwYWNrYWdlTG9jYWxKc29uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBuZXcgdmVyc2lvbiB0byBhIHByZXZpb3VzIGxvY2FsIHBhY2thZ2UuXG4gICAqIEBwYXJhbSB7Kn0gbmFtZVxuICAgKiBAcGFyYW0geyp9IHZlcnNpb25cbiAgICogQHBhcmFtIHsqfSBtZXRhZGF0YVxuICAgKiBAcGFyYW0geyp9IHRhZ1xuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqL1xuICBwdWJsaWMgYWRkVmVyc2lvbihcbiAgICBuYW1lOiBzdHJpbmcsXG4gICAgdmVyc2lvbjogc3RyaW5nLFxuICAgIG1ldGFkYXRhOiBWZXJzaW9uLFxuICAgIHRhZzogU3RyaW5nVmFsdWUsXG4gICAgY2FsbGJhY2s6IENhbGxiYWNrXG4gICk6IHZvaWQge1xuICAgIHRoaXMuX3VwZGF0ZVBhY2thZ2UoXG4gICAgICBuYW1lLFxuICAgICAgKGRhdGEsIGNiOiBDYWxsYmFjayk6IHZvaWQgPT4ge1xuICAgICAgICAvLyBrZWVwIG9ubHkgb25lIHJlYWRtZSBwZXIgcGFja2FnZVxuICAgICAgICBkYXRhLnJlYWRtZSA9IG1ldGFkYXRhLnJlYWRtZTtcblxuICAgICAgICAvLyBUT0RPOiBsb2Rhc2ggcmVtb3ZlXG4gICAgICAgIG1ldGFkYXRhID0gY2xlYW5VcFJlYWRtZShtZXRhZGF0YSk7XG4gICAgICAgIG1ldGFkYXRhLmNvbnRyaWJ1dG9ycyA9IG5vcm1hbGl6ZUNvbnRyaWJ1dG9ycyhtZXRhZGF0YS5jb250cmlidXRvcnMgYXMgQXV0aG9yW10pO1xuXG4gICAgICAgIGNvbnN0IGhhc1ZlcnNpb24gPSBkYXRhLnZlcnNpb25zW3ZlcnNpb25dICE9IG51bGw7XG4gICAgICAgIGlmIChoYXNWZXJzaW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGNiKEVycm9yQ29kZS5nZXRDb25mbGljdCgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIHVwbG9hZGVkIHRhcmJhbGwgaGFzIGEgZGlmZmVyZW50IHNoYXN1bSwgaXQncyB2ZXJ5IGxpa2VseSB0aGF0IHdlIGhhdmUgc29tZSBraW5kIG9mIGVycm9yXG4gICAgICAgIGlmIChpc09iamVjdChtZXRhZGF0YS5kaXN0KSAmJiBfLmlzU3RyaW5nKG1ldGFkYXRhLmRpc3QudGFyYmFsbCkpIHtcbiAgICAgICAgICBjb25zdCB0YXJiYWxsID0gbWV0YWRhdGEuZGlzdC50YXJiYWxsLnJlcGxhY2UoLy4qXFwvLywgJycpO1xuXG4gICAgICAgICAgaWYgKGlzT2JqZWN0KGRhdGEuX2F0dGFjaG1lbnRzW3RhcmJhbGxdKSkge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBfLmlzTmlsKGRhdGEuX2F0dGFjaG1lbnRzW3RhcmJhbGxdLnNoYXN1bSkgPT09IGZhbHNlICYmXG4gICAgICAgICAgICAgIF8uaXNOaWwobWV0YWRhdGEuZGlzdC5zaGFzdW0pID09PSBmYWxzZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGlmIChkYXRhLl9hdHRhY2htZW50c1t0YXJiYWxsXS5zaGFzdW0gIT0gbWV0YWRhdGEuZGlzdC5zaGFzdW0pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBgc2hhc3VtIGVycm9yLCAke2RhdGEuX2F0dGFjaG1lbnRzW3RhcmJhbGxdLnNoYXN1bX0gIT0gJHttZXRhZGF0YS5kaXN0LnNoYXN1bX1gO1xuICAgICAgICAgICAgICAgIHJldHVybiBjYihFcnJvckNvZGUuZ2V0QmFkUmVxdWVzdChlcnJvck1lc3NhZ2UpKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcblxuICAgICAgICAgICAgLy8gc29tZSBvbGQgc3RvcmFnZSBkbyBub3QgaGF2ZSB0aGlzIGZpZWxkICM3NDBcbiAgICAgICAgICAgIGlmIChfLmlzTmlsKGRhdGEudGltZSkpIHtcbiAgICAgICAgICAgICAgZGF0YS50aW1lID0ge307XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGEudGltZVsnbW9kaWZpZWQnXSA9IGN1cnJlbnREYXRlO1xuXG4gICAgICAgICAgICBpZiAoJ2NyZWF0ZWQnIGluIGRhdGEudGltZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgZGF0YS50aW1lLmNyZWF0ZWQgPSBjdXJyZW50RGF0ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YS50aW1lW3ZlcnNpb25dID0gY3VycmVudERhdGU7XG4gICAgICAgICAgICBkYXRhLl9hdHRhY2htZW50c1t0YXJiYWxsXS52ZXJzaW9uID0gdmVyc2lvbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBkYXRhLnZlcnNpb25zW3ZlcnNpb25dID0gbWV0YWRhdGE7XG4gICAgICAgIHRhZ1ZlcnNpb24oZGF0YSwgdmVyc2lvbiwgdGFnKTtcblxuICAgICAgICB0aGlzLnN0b3JhZ2VQbHVnaW4uYWRkKG5hbWUsIChhZGRGYWlsZWQpOiB2b2lkID0+IHtcbiAgICAgICAgICBpZiAoYWRkRmFpbGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gY2IoRXJyb3JDb2RlLmdldEJhZERhdGEoYWRkRmFpbGVkLm1lc3NhZ2UpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjYigpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBjYWxsYmFja1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogTWVyZ2UgYSBuZXcgbGlzdCBvZiB0YWdzIGZvciBhIGxvY2FsIHBhY2thZ2VzIHdpdGggdGhlIGV4aXN0aW5nIG9uZS5cbiAgICogQHBhcmFtIHsqfSBwa2dOYW1lXG4gICAqIEBwYXJhbSB7Kn0gdGFnc1xuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqL1xuICBwdWJsaWMgbWVyZ2VUYWdzKHBrZ05hbWU6IHN0cmluZywgdGFnczogTWVyZ2VUYWdzLCBjYWxsYmFjazogQ2FsbGJhY2spOiB2b2lkIHtcbiAgICB0aGlzLl91cGRhdGVQYWNrYWdlKFxuICAgICAgcGtnTmFtZSxcbiAgICAgIChkYXRhLCBjYik6IHZvaWQgPT4ge1xuICAgICAgICAvKiBlc2xpbnQgZ3VhcmQtZm9yLWluOiAwICovXG4gICAgICAgIGZvciAoY29uc3QgdGFnIGluIHRhZ3MpIHtcbiAgICAgICAgICAvLyB0aGlzIGhhbmRsZSBkaXN0LXRhZyBybSBjb21tYW5kXG4gICAgICAgICAgaWYgKF8uaXNOdWxsKHRhZ3NbdGFnXSkpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBkYXRhW0RJU1RfVEFHU11bdGFnXTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChfLmlzTmlsKGRhdGEudmVyc2lvbnNbdGFnc1t0YWddXSkpIHtcbiAgICAgICAgICAgIHJldHVybiBjYih0aGlzLl9nZXRWZXJzaW9uTm90Rm91bmQoKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHZlcnNpb246IHN0cmluZyA9IHRhZ3NbdGFnXTtcbiAgICAgICAgICB0YWdWZXJzaW9uKGRhdGEsIHZlcnNpb24sIHRhZyk7XG4gICAgICAgIH1cbiAgICAgICAgY2IobnVsbCk7XG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiB2ZXJzaW9uIG5vdCBmb3VuZFxuICAgKiBAcmV0dXJuIHtTdHJpbmd9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIF9nZXRWZXJzaW9uTm90Rm91bmQoKTogYW55IHtcbiAgICByZXR1cm4gRXJyb3JDb2RlLmdldE5vdEZvdW5kKEFQSV9FUlJPUi5WRVJTSU9OX05PVF9FWElTVCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJuIGZpbGUgbm8gYXZhaWxhYmxlXG4gICAqIEByZXR1cm4ge1N0cmluZ31cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgX2dldEZpbGVOb3RBdmFpbGFibGUoKTogYW55IHtcbiAgICByZXR1cm4gRXJyb3JDb2RlLmdldE5vdEZvdW5kKCdubyBzdWNoIGZpbGUgYXZhaWxhYmxlJyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHRoZSBwYWNrYWdlIG1ldGFkYXRhLCB0YWdzIGFuZCBhdHRhY2htZW50cyAodGFyYmFsbHMpLlxuICAgKiBOb3RlOiBDdXJyZW50bHkgc3VwcG9ydHMgdW5wdWJsaXNoaW5nIGFuZCBkZXByZWNhdGlvbi5cbiAgICogQHBhcmFtIHsqfSBuYW1lXG4gICAqIEBwYXJhbSB7Kn0gaW5jb21pbmdQa2dcbiAgICogQHBhcmFtIHsqfSByZXZpc2lvblxuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgKi9cbiAgcHVibGljIGNoYW5nZVBhY2thZ2UoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIGluY29taW5nUGtnOiBQYWNrYWdlLFxuICAgIHJldmlzaW9uOiBzdHJpbmcgfCB2b2lkLFxuICAgIGNhbGxiYWNrOiBDYWxsYmFja1xuICApOiB2b2lkIHtcbiAgICBpZiAoIWlzT2JqZWN0KGluY29taW5nUGtnLnZlcnNpb25zKSB8fCAhaXNPYmplY3QoaW5jb21pbmdQa2dbRElTVF9UQUdTXSkpIHtcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgbmFtZSB9LCBgY2hhbmdlUGFja2FnZSBiYWQgZGF0YSBmb3IgQHtuYW1lfWApO1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKEVycm9yQ29kZS5nZXRCYWREYXRhKCkpO1xuICAgIH1cbiAgICBkZWJ1ZygnY2hhbmdlUGFja2FnZSB1ZGFwdGluZyBwYWNrYWdlIGZvciAlbycsIG5hbWUpO1xuICAgIHRoaXMuX3VwZGF0ZVBhY2thZ2UoXG4gICAgICBuYW1lLFxuICAgICAgKGxvY2FsRGF0YTogUGFja2FnZSwgY2I6IENhbGxiYWNrKTogdm9pZCA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgdmVyc2lvbiBpbiBsb2NhbERhdGEudmVyc2lvbnMpIHtcbiAgICAgICAgICBjb25zdCBpbmNvbWluZ1ZlcnNpb24gPSBpbmNvbWluZ1BrZy52ZXJzaW9uc1t2ZXJzaW9uXTtcbiAgICAgICAgICBpZiAoXy5pc05pbChpbmNvbWluZ1ZlcnNpb24pKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKHsgbmFtZTogbmFtZSwgdmVyc2lvbjogdmVyc2lvbiB9LCAndW5wdWJsaXNoaW5nIEB7bmFtZX1AQHt2ZXJzaW9ufScpO1xuXG4gICAgICAgICAgICAvLyBGSVhNRTogSSBwcmVmZXIgcmV0dXJuIGEgbmV3IG9iamVjdCByYXRoZXIgbXV0YXRlIHRoZSBtZXRhZGF0YVxuICAgICAgICAgICAgZGVsZXRlIGxvY2FsRGF0YS52ZXJzaW9uc1t2ZXJzaW9uXTtcbiAgICAgICAgICAgIGRlbGV0ZSBsb2NhbERhdGEudGltZSFbdmVyc2lvbl07XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgZmlsZSBpbiBsb2NhbERhdGEuX2F0dGFjaG1lbnRzKSB7XG4gICAgICAgICAgICAgIGlmIChsb2NhbERhdGEuX2F0dGFjaG1lbnRzW2ZpbGVdLnZlcnNpb24gPT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxEYXRhLl9hdHRhY2htZW50c1tmaWxlXS52ZXJzaW9uO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaW5jb21pbmdWZXJzaW9uLCAnZGVwcmVjYXRlZCcpKSB7XG4gICAgICAgICAgICBjb25zdCBpbmNvbWluZ0RlcHJlY2F0ZWQgPSBpbmNvbWluZ1ZlcnNpb24uZGVwcmVjYXRlZDtcbiAgICAgICAgICAgIGlmIChpbmNvbWluZ0RlcHJlY2F0ZWQgIT0gbG9jYWxEYXRhLnZlcnNpb25zW3ZlcnNpb25dLmRlcHJlY2F0ZWQpIHtcbiAgICAgICAgICAgICAgaWYgKCFpbmNvbWluZ0RlcHJlY2F0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKFxuICAgICAgICAgICAgICAgICAgeyBuYW1lOiBuYW1lLCB2ZXJzaW9uOiB2ZXJzaW9uIH0sXG4gICAgICAgICAgICAgICAgICAndW5kZXByZWNhdGluZyBAe25hbWV9QEB7dmVyc2lvbn0nXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgbG9jYWxEYXRhLnZlcnNpb25zW3ZlcnNpb25dLmRlcHJlY2F0ZWQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dnZXIuaW5mbyhcbiAgICAgICAgICAgICAgICAgIHsgbmFtZTogbmFtZSwgdmVyc2lvbjogdmVyc2lvbiB9LFxuICAgICAgICAgICAgICAgICAgJ2RlcHJlY2F0aW5nIEB7bmFtZX1AQHt2ZXJzaW9ufSdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGxvY2FsRGF0YS52ZXJzaW9uc1t2ZXJzaW9uXS5kZXByZWNhdGVkID0gaW5jb21pbmdEZXByZWNhdGVkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGxvY2FsRGF0YS50aW1lIS5tb2RpZmllZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsb2NhbERhdGFbVVNFUlNdID0gaW5jb21pbmdQa2dbVVNFUlNdO1xuICAgICAgICBsb2NhbERhdGFbRElTVF9UQUdTXSA9IGluY29taW5nUGtnW0RJU1RfVEFHU107XG4gICAgICAgIGNiKG51bGwpO1xuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uIChlcnIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICAvKipcbiAgICogUmVtb3ZlIGEgdGFyYmFsbC5cbiAgICogQHBhcmFtIHsqfSBuYW1lXG4gICAqIEBwYXJhbSB7Kn0gZmlsZW5hbWVcbiAgICogQHBhcmFtIHsqfSByZXZpc2lvblxuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqL1xuICBwdWJsaWMgcmVtb3ZlVGFyYmFsbChuYW1lOiBzdHJpbmcsIGZpbGVuYW1lOiBzdHJpbmcsIHJldmlzaW9uOiBzdHJpbmcsIGNhbGxiYWNrOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGFzc2VydCh2YWxpZGF0ZU5hbWUoZmlsZW5hbWUpKTtcblxuICAgIHRoaXMuX3VwZGF0ZVBhY2thZ2UoXG4gICAgICBuYW1lLFxuICAgICAgKGRhdGEsIGNiKTogdm9pZCA9PiB7XG4gICAgICAgIGlmIChkYXRhLl9hdHRhY2htZW50c1tmaWxlbmFtZV0pIHtcbiAgICAgICAgICBkZWxldGUgZGF0YS5fYXR0YWNobWVudHNbZmlsZW5hbWVdO1xuICAgICAgICAgIGNiKG51bGwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNiKHRoaXMuX2dldEZpbGVOb3RBdmFpbGFibGUoKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoZXJyOiBhbnkpOiB2b2lkID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0b3JhZ2UgPSB0aGlzLl9nZXRMb2NhbFN0b3JhZ2UobmFtZSk7XG5cbiAgICAgICAgaWYgKHN0b3JhZ2UpIHtcbiAgICAgICAgICBzdG9yYWdlLmRlbGV0ZVBhY2thZ2UoZmlsZW5hbWUsIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGEgdGFyYmFsbC5cbiAgICogQHBhcmFtIHtTdHJpbmd9IG5hbWVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGZpbGVuYW1lXG4gICAqIEByZXR1cm4ge1N0cmVhbX1cbiAgICovXG4gIHB1YmxpYyBhZGRUYXJiYWxsKG5hbWU6IHN0cmluZywgZmlsZW5hbWU6IHN0cmluZykge1xuICAgIGFzc2VydCh2YWxpZGF0ZU5hbWUoZmlsZW5hbWUpKTtcblxuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIGNvbnN0IHNoYU9uZUhhc2ggPSBjcmVhdGVUYXJiYWxsSGFzaCgpO1xuICAgIGNvbnN0IHVwbG9hZFN0cmVhbSA9IG5ldyBVcGxvYWRUYXJiYWxsKHt9KTtcbiAgICBjb25zdCBfdHJhbnNmb3JtID0gdXBsb2FkU3RyZWFtLl90cmFuc2Zvcm07XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuX2dldExvY2FsU3RvcmFnZShuYW1lKTtcblxuICAgIHVwbG9hZFN0cmVhbS5hYm9ydCA9IGZ1bmN0aW9uICgpOiB2b2lkIHt9O1xuICAgIHVwbG9hZFN0cmVhbS5kb25lID0gZnVuY3Rpb24gKCk6IHZvaWQge307XG5cbiAgICB1cGxvYWRTdHJlYW0uX3RyYW5zZm9ybSA9IGZ1bmN0aW9uIChkYXRhLCAuLi5hcmdzKTogdm9pZCB7XG4gICAgICBzaGFPbmVIYXNoLnVwZGF0ZShkYXRhKTtcbiAgICAgIC8vIG1lYXN1cmUgdGhlIGxlbmd0aCBmb3IgdmFsaWRhdGlvbiByZWFzb25zXG4gICAgICBsZW5ndGggKz0gZGF0YS5sZW5ndGg7XG4gICAgICBjb25zdCBhcHBsaWVkRGF0YSA9IFtkYXRhLCAuLi5hcmdzXTtcbiAgICAgIC8vIEZJWE1FOiBub3Qgc3VyZSBhYm91dCB0aGlzIGFwcHJvYWNoLCB0c2MgY29tcGxhaW5zXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBfdHJhbnNmb3JtLmFwcGx5KHVwbG9hZFN0cmVhbSwgYXBwbGllZERhdGEpO1xuICAgIH07XG5cbiAgICBpZiAobmFtZSA9PT0gJ19fcHJvdG9fXycpIHtcbiAgICAgIHByb2Nlc3MubmV4dFRpY2soKCk6IHZvaWQgPT4ge1xuICAgICAgICB1cGxvYWRTdHJlYW0uZW1pdCgnZXJyb3InLCBFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKCkpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdXBsb2FkU3RyZWFtO1xuICAgIH1cblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcHJvY2Vzcy5uZXh0VGljaygoKTogdm9pZCA9PiB7XG4gICAgICAgIHVwbG9hZFN0cmVhbS5lbWl0KCdlcnJvcicsIFwiY2FuJ3QgdXBsb2FkIHRoaXMgcGFja2FnZVwiKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHVwbG9hZFN0cmVhbTtcbiAgICB9XG5cbiAgICBjb25zdCB3cml0ZVN0cmVhbSA9IHN0b3JhZ2Uud3JpdGVUYXJiYWxsKGZpbGVuYW1lKTtcblxuICAgIHdyaXRlU3RyZWFtLm9uKCdlcnJvcicsIChlcnIpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGlmIChlcnIuY29kZSA9PT0gU1RPUkFHRS5GSUxFX0VYSVNUX0VSUk9SIHx8IGVyci5jb2RlID09PSBIVFRQX1NUQVRVUy5DT05GTElDVCkge1xuICAgICAgICB1cGxvYWRTdHJlYW0uZW1pdCgnZXJyb3InLCBFcnJvckNvZGUuZ2V0Q29uZmxpY3QoKSk7XG4gICAgICAgIHVwbG9hZFN0cmVhbS5hYm9ydCgpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICB9IGVsc2UgaWYgKGVyci5jb2RlID09PSBTVE9SQUdFLk5PX1NVQ0hfRklMRV9FUlJPUiB8fCBlcnIuY29kZSA9PT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgIC8vIGNoZWNrIGlmIHBhY2thZ2UgZXhpc3RzIHRvIHRocm93IGFuIGFwcHJvcHJpYXRlIG1lc3NhZ2VcbiAgICAgICAgdGhpcy5nZXRQYWNrYWdlTWV0YWRhdGEobmFtZSwgZnVuY3Rpb24gKF9lcnI6IGFueSwgX3JlczogUGFja2FnZSk6IHZvaWQge1xuICAgICAgICAgIGlmIChfZXJyKSB7XG4gICAgICAgICAgICB1cGxvYWRTdHJlYW0uZW1pdCgnZXJyb3InLCBfZXJyKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdXBsb2FkU3RyZWFtLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdXBsb2FkU3RyZWFtLmVtaXQoJ2Vycm9yJywgZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHdyaXRlU3RyZWFtLm9uKCdvcGVuJywgZnVuY3Rpb24gKCk6IHZvaWQge1xuICAgICAgLy8gcmUtZW1pdHRpbmcgb3BlbiBiZWNhdXNlIGl0J3MgaGFuZGxlZCBpbiBzdG9yYWdlLmpzXG4gICAgICB1cGxvYWRTdHJlYW0uZW1pdCgnb3BlbicpO1xuICAgIH0pO1xuXG4gICAgd3JpdGVTdHJlYW0ub24oJ3N1Y2Nlc3MnLCAoKTogdm9pZCA9PiB7XG4gICAgICB0aGlzLl91cGRhdGVQYWNrYWdlKFxuICAgICAgICBuYW1lLFxuICAgICAgICBmdW5jdGlvbiB1cGRhdGVyKGRhdGEsIGNiKTogdm9pZCB7XG4gICAgICAgICAgZGF0YS5fYXR0YWNobWVudHNbZmlsZW5hbWVdID0ge1xuICAgICAgICAgICAgc2hhc3VtOiBzaGFPbmVIYXNoLmRpZ2VzdCgnaGV4JyksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBjYihudWxsKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKGVycik6IHZvaWQge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIHVwbG9hZFN0cmVhbS5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHVwbG9hZFN0cmVhbS5lbWl0KCdzdWNjZXNzJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgdXBsb2FkU3RyZWFtLmFib3J0ID0gZnVuY3Rpb24gKCk6IHZvaWQge1xuICAgICAgd3JpdGVTdHJlYW0uYWJvcnQoKTtcbiAgICB9O1xuXG4gICAgdXBsb2FkU3RyZWFtLmRvbmUgPSBmdW5jdGlvbiAoKTogdm9pZCB7XG4gICAgICBpZiAoIWxlbmd0aCkge1xuICAgICAgICB1cGxvYWRTdHJlYW0uZW1pdCgnZXJyb3InLCBFcnJvckNvZGUuZ2V0QmFkRGF0YSgncmVmdXNpbmcgdG8gYWNjZXB0IHplcm8tbGVuZ3RoIGZpbGUnKSk7XG4gICAgICAgIHdyaXRlU3RyZWFtLmFib3J0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3cml0ZVN0cmVhbS5kb25lKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHVwbG9hZFN0cmVhbS5waXBlKHdyaXRlU3RyZWFtKTtcblxuICAgIHJldHVybiB1cGxvYWRTdHJlYW07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGEgdGFyYmFsbC5cbiAgICogQHBhcmFtIHsqfSBuYW1lXG4gICAqIEBwYXJhbSB7Kn0gZmlsZW5hbWVcbiAgICogQHJldHVybiB7UmVhZFRhcmJhbGx9XG4gICAqL1xuICBwdWJsaWMgZ2V0VGFyYmFsbChuYW1lOiBzdHJpbmcsIGZpbGVuYW1lOiBzdHJpbmcpIHtcbiAgICBhc3NlcnQodmFsaWRhdGVOYW1lKGZpbGVuYW1lKSk7XG5cbiAgICBjb25zdCBzdG9yYWdlID0gdGhpcy5fZ2V0TG9jYWxTdG9yYWdlKG5hbWUpO1xuXG4gICAgaWYgKF8uaXNOaWwoc3RvcmFnZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVGYWlsdXJlU3RyZWFtUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fc3RyZWFtU3VjY2Vzc1JlYWRUYXJCYWxsKHN0b3JhZ2UsIGZpbGVuYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gYSBzdHJlYW0gdGhhdCBlbWl0cyBhIHJlYWQgZmFpbHVyZS5cbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybiB7UmVhZFRhcmJhbGx9XG4gICAqL1xuICBwcml2YXRlIF9jcmVhdGVGYWlsdXJlU3RyZWFtUmVzcG9uc2UoKSB7XG4gICAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRUYXJiYWxsKHt9KTtcblxuICAgIHByb2Nlc3MubmV4dFRpY2soKCk6IHZvaWQgPT4ge1xuICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgdGhpcy5fZ2V0RmlsZU5vdEF2YWlsYWJsZSgpKTtcbiAgICB9KTtcbiAgICByZXR1cm4gc3RyZWFtO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBhIHN0cmVhbSB0aGF0IGVtaXRzIHRoZSB0YXJiYWxsIGRhdGFcbiAgICogQHBhcmFtIHtPYmplY3R9IHN0b3JhZ2VcbiAgICogQHBhcmFtIHtTdHJpbmd9IGZpbGVuYW1lXG4gICAqIEBwcml2YXRlXG4gICAqIEByZXR1cm4ge1JlYWRUYXJiYWxsfVxuICAgKi9cbiAgcHJpdmF0ZSBfc3RyZWFtU3VjY2Vzc1JlYWRUYXJCYWxsKHN0b3JhZ2U6IGFueSwgZmlsZW5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBSZWFkVGFyYmFsbCh7fSk7XG4gICAgY29uc3QgcmVhZFRhcmJhbGxTdHJlYW0gPSBzdG9yYWdlLnJlYWRUYXJiYWxsKGZpbGVuYW1lKTtcbiAgICBjb25zdCBlNDA0ID0gRXJyb3JDb2RlLmdldE5vdEZvdW5kO1xuXG4gICAgc3RyZWFtLmFib3J0ID0gZnVuY3Rpb24gKCk6IHZvaWQge1xuICAgICAgaWYgKF8uaXNOaWwocmVhZFRhcmJhbGxTdHJlYW0pID09PSBmYWxzZSkge1xuICAgICAgICByZWFkVGFyYmFsbFN0cmVhbS5hYm9ydCgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZWFkVGFyYmFsbFN0cmVhbS5vbignZXJyb3InLCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBpZiAoZXJyLmNvZGUgPT09IFNUT1JBR0UuTk9fU1VDSF9GSUxFX0VSUk9SIHx8IGVyci5jb2RlID09PSBIVFRQX1NUQVRVUy5OT1RfRk9VTkQpIHtcbiAgICAgICAgc3RyZWFtLmVtaXQoJ2Vycm9yJywgZTQwNCgnbm8gc3VjaCBmaWxlIGF2YWlsYWJsZScpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0cmVhbS5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZWFkVGFyYmFsbFN0cmVhbS5vbignY29udGVudC1sZW5ndGgnLCBmdW5jdGlvbiAoY29udGVudCk6IHZvaWQge1xuICAgICAgc3RyZWFtLmVtaXQoJ2NvbnRlbnQtbGVuZ3RoJywgY29udGVudCk7XG4gICAgfSk7XG5cbiAgICByZWFkVGFyYmFsbFN0cmVhbS5vbignb3BlbicsIGZ1bmN0aW9uICgpOiB2b2lkIHtcbiAgICAgIC8vIHJlLWVtaXR0aW5nIG9wZW4gYmVjYXVzZSBpdCdzIGhhbmRsZWQgaW4gc3RvcmFnZS5qc1xuICAgICAgc3RyZWFtLmVtaXQoJ29wZW4nKTtcbiAgICAgIHJlYWRUYXJiYWxsU3RyZWFtLnBpcGUoc3RyZWFtKTtcbiAgICB9KTtcblxuICAgIHJldHVybiBzdHJlYW07XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgYSBwYWNrYWdlIGJ5IG5hbWUuXG4gICAqIEBwYXJhbSB7Kn0gbmFtZVxuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgKi9cbiAgcHVibGljIGdldFBhY2thZ2VNZXRhZGF0YShuYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBDYWxsYmFjayA9ICgpOiB2b2lkID0+IHt9KTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuX2dldExvY2FsU3RvcmFnZShuYW1lKTtcbiAgICBpZiAoXy5pc05pbChzdG9yYWdlKSkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKEVycm9yQ29kZS5nZXROb3RGb3VuZCgpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9yZWFkUGFja2FnZShuYW1lLCBzdG9yYWdlLCBjYWxsYmFjayk7XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoIGEgbG9jYWwgcGFja2FnZS5cbiAgICogQHBhcmFtIHsqfSBzdGFydEtleVxuICAgKiBAcGFyYW0geyp9IG9wdGlvbnNcbiAgICogQHJldHVybiB7RnVuY3Rpb259XG4gICAqL1xuICBwdWJsaWMgc2VhcmNoKHN0YXJ0S2V5OiBzdHJpbmcsIG9wdGlvbnM6IGFueSkge1xuICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBSZWFkVGFyYmFsbCh7IG9iamVjdE1vZGU6IHRydWUgfSk7XG5cbiAgICB0aGlzLl9zZWFyY2hFYWNoUGFja2FnZShcbiAgICAgIChpdGVtOiBQYWNrYWdlLCBjYjogQ2FsbGJhY2spOiB2b2lkID0+IHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBpZiAoaXRlbS50aW1lID4gcGFyc2VJbnQoc3RhcnRLZXksIDEwKSkge1xuICAgICAgICAgIHRoaXMuZ2V0UGFja2FnZU1ldGFkYXRhKGl0ZW0ubmFtZSwgKGVycjogYW55LCBkYXRhOiBQYWNrYWdlKTogdm9pZCA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYihlcnIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCB0aW1lID0gbmV3IERhdGUoaXRlbS50aW1lKS50b0lTT1N0cmluZygpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gcHJlcGFyZVNlYXJjaFBhY2thZ2UoZGF0YSwgdGltZSk7XG4gICAgICAgICAgICBpZiAoXy5pc05pbChyZXN1bHQpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBzdHJlYW0ucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2IobnVsbCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2IobnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbiBvbkVuZChlcnIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHN0cmVhbS5lbWl0KCdlcnJvcicsIGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN0cmVhbS5lbmQoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmV0dXJuIHN0cmVhbTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhIHdyYXBwZXIgdGhhdCBwcm92aWRlIGFjY2VzcyB0byB0aGUgcGFja2FnZSBsb2NhdGlvbi5cbiAgICogQHBhcmFtIHtPYmplY3R9IHBrZ05hbWUgcGFja2FnZSBuYW1lLlxuICAgKiBAcmV0dXJuIHtPYmplY3R9XG4gICAqL1xuICBwcml2YXRlIF9nZXRMb2NhbFN0b3JhZ2UocGtnTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RvcmFnZVBsdWdpbi5nZXRQYWNrYWdlU3RvcmFnZShwa2dOYW1lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkIGEganNvbiBmaWxlIGZyb20gc3RvcmFnZS5cbiAgICogQHBhcmFtIHtPYmplY3R9IHN0b3JhZ2VcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcbiAgICovXG4gIHByaXZhdGUgX3JlYWRQYWNrYWdlKG5hbWU6IHN0cmluZywgc3RvcmFnZTogYW55LCBjYWxsYmFjazogQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBzdG9yYWdlLnJlYWRQYWNrYWdlKG5hbWUsIChlcnIsIHJlc3VsdCk6IHZvaWQgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBpZiAoZXJyLmNvZGUgPT09IFNUT1JBR0UuTk9fU1VDSF9GSUxFX0VSUk9SIHx8IGVyci5jb2RlID09PSBIVFRQX1NUQVRVUy5OT1RfRk9VTkQpIHtcbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soRXJyb3JDb2RlLmdldE5vdEZvdW5kKCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYWxsYmFjayh0aGlzLl9pbnRlcm5hbEVycm9yKGVyciwgU1RPUkFHRS5QQUNLQUdFX0ZJTEVfTkFNRSwgJ2Vycm9yIHJlYWRpbmcnKSk7XG4gICAgICB9XG5cbiAgICAgIGNhbGxiYWNrKGVyciwgbm9ybWFsaXplUGFja2FnZShyZXN1bHQpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXYWxrcyB0aHJvdWdoIGVhY2ggcGFja2FnZSBhbmQgY2FsbHMgYG9uX3BhY2thZ2VgIG9uIHRoZW0uXG4gICAqIEBwYXJhbSB7Kn0gb25QYWNrYWdlXG4gICAqIEBwYXJhbSB7Kn0gb25FbmRcbiAgICovXG4gIHByaXZhdGUgX3NlYXJjaEVhY2hQYWNrYWdlKG9uUGFja2FnZTogb25TZWFyY2hQYWNrYWdlLCBvbkVuZDogb25FbmRTZWFyY2hQYWNrYWdlKTogdm9pZCB7XG4gICAgLy8gc2F2ZSB3YWl0IHdoZXRoZXIgcGx1Z2luIHN0aWxsIGRvIG5vdCBzdXBwb3J0IHNlYXJjaCBmdW5jdGlvbmFsaXR5XG4gICAgaWYgKF8uaXNOaWwodGhpcy5zdG9yYWdlUGx1Z2luLnNlYXJjaCkpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ3BsdWdpbiBzZWFyY2ggbm90IGltcGxlbWVudGVkIHlldCcpO1xuICAgICAgb25FbmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdG9yYWdlUGx1Z2luLnNlYXJjaChvblBhY2thZ2UsIG9uRW5kLCB2YWxpZGF0ZU5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBlaXRoZXIgYSBwcmV2aW91cyBjcmVhdGVkIGxvY2FsIHBhY2thZ2Ugb3IgYSBib2lsZXJwbGF0ZS5cbiAgICogQHBhcmFtIHsqfSBwa2dOYW1lXG4gICAqIEBwYXJhbSB7Kn0gY2FsbGJhY2tcbiAgICogQHJldHVybiB7RnVuY3Rpb259XG4gICAqL1xuICBwcml2YXRlIF9yZWFkQ3JlYXRlUGFja2FnZShwa2dOYW1lOiBzdHJpbmcsIGNhbGxiYWNrOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGNvbnN0IHN0b3JhZ2U6IGFueSA9IHRoaXMuX2dldExvY2FsU3RvcmFnZShwa2dOYW1lKTtcbiAgICBpZiAoXy5pc05pbChzdG9yYWdlKSkge1xuICAgICAgdGhpcy5fY3JlYXRlTmV3UGFja2FnZShwa2dOYW1lLCBjYWxsYmFjayk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgc3RvcmFnZS5yZWFkUGFja2FnZShwa2dOYW1lLCAoZXJyLCBkYXRhKTogdm9pZCA9PiB7XG4gICAgICAvLyBUT0RPOiByYWNlIGNvbmRpdGlvblxuICAgICAgaWYgKF8uaXNOaWwoZXJyKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgaWYgKGVyci5jb2RlID09PSBTVE9SQUdFLk5PX1NVQ0hfRklMRV9FUlJPUiB8fCBlcnIuY29kZSA9PT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgICAgZGF0YSA9IGdlbmVyYXRlUGFja2FnZVRlbXBsYXRlKHBrZ05hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayh0aGlzLl9pbnRlcm5hbEVycm9yKGVyciwgU1RPUkFHRS5QQUNLQUdFX0ZJTEVfTkFNRSwgJ2Vycm9yIHJlYWRpbmcnKSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY2FsbGJhY2sobnVsbCwgbm9ybWFsaXplUGFja2FnZShkYXRhKSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIF9jcmVhdGVOZXdQYWNrYWdlKG5hbWU6IHN0cmluZywgY2FsbGJhY2s6IENhbGxiYWNrKTogQ2FsbGJhY2sge1xuICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBub3JtYWxpemVQYWNrYWdlKGdlbmVyYXRlUGFja2FnZVRlbXBsYXRlKG5hbWUpKSk7XG4gIH1cblxuICAvKipcbiAgICogSGFuZGxlIGludGVybmFsIGVycm9yXG4gICAqIEBwYXJhbSB7Kn0gZXJyXG4gICAqIEBwYXJhbSB7Kn0gZmlsZVxuICAgKiBAcGFyYW0geyp9IG1lc3NhZ2VcbiAgICogQHJldHVybiB7T2JqZWN0fSBFcnJvciBpbnN0YW5jZVxuICAgKi9cbiAgcHJpdmF0ZSBfaW50ZXJuYWxFcnJvcihlcnI6IHN0cmluZywgZmlsZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcpOiBhbnkge1xuICAgIHRoaXMubG9nZ2VyLmVycm9yKHsgZXJyOiBlcnIsIGZpbGU6IGZpbGUgfSwgYCR7bWVzc2FnZX0gIEB7ZmlsZX06IEB7IWVyci5tZXNzYWdlfWApO1xuXG4gICAgcmV0dXJuIEVycm9yQ29kZS5nZXRJbnRlcm5hbEVycm9yKCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHsqfSBuYW1lIHBhY2thZ2UgbmFtZVxuICAgKiBAcGFyYW0geyp9IHVwZGF0ZUhhbmRsZXIgZnVuY3Rpb24ocGFja2FnZSwgY2IpIC0gdXBkYXRlIGZ1bmN0aW9uXG4gICAqIEBwYXJhbSB7Kn0gY2FsbGJhY2sgY2FsbGJhY2sgdGhhdCBnZXRzIGludm9rZWQgYWZ0ZXIgaXQncyBhbGwgdXBkYXRlZFxuICAgKiBAcmV0dXJuIHtGdW5jdGlvbn1cbiAgICovXG4gIHByaXZhdGUgX3VwZGF0ZVBhY2thZ2UoXG4gICAgbmFtZTogc3RyaW5nLFxuICAgIHVwZGF0ZUhhbmRsZXI6IFN0b3JhZ2VVcGRhdGVDYWxsYmFjayxcbiAgICBjYWxsYmFjazogQ2FsbGJhY2tcbiAgKTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZSA9IHRoaXMuX2dldExvY2FsU3RvcmFnZShuYW1lKTtcblxuICAgIGlmICghc3RvcmFnZSkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKEVycm9yQ29kZS5nZXROb3RGb3VuZCgpKTtcbiAgICB9XG5cbiAgICBzdG9yYWdlLnVwZGF0ZVBhY2thZ2UoXG4gICAgICBuYW1lLFxuICAgICAgdXBkYXRlSGFuZGxlcixcbiAgICAgIHRoaXMuX3dyaXRlUGFja2FnZS5iaW5kKHRoaXMpLFxuICAgICAgbm9ybWFsaXplUGFja2FnZSxcbiAgICAgIGNhbGxiYWNrXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHJldmlzaW9uIChfcmV2KSBzdHJpbmcgZm9yIGEgcGFja2FnZS5cbiAgICogQHBhcmFtIHsqfSBuYW1lXG4gICAqIEBwYXJhbSB7Kn0ganNvblxuICAgKiBAcGFyYW0geyp9IGNhbGxiYWNrXG4gICAqIEByZXR1cm4ge0Z1bmN0aW9ufVxuICAgKi9cbiAgcHJpdmF0ZSBfd3JpdGVQYWNrYWdlKG5hbWU6IHN0cmluZywganNvbjogUGFja2FnZSwgY2FsbGJhY2s6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3Qgc3RvcmFnZTogYW55ID0gdGhpcy5fZ2V0TG9jYWxTdG9yYWdlKG5hbWUpO1xuICAgIGlmIChfLmlzTmlsKHN0b3JhZ2UpKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgc3RvcmFnZS5zYXZlUGFja2FnZShuYW1lLCB0aGlzLl9zZXREZWZhdWx0UmV2aXNpb24oanNvbiksIGNhbGxiYWNrKTtcbiAgfVxuXG4gIHByaXZhdGUgX3NldERlZmF1bHRSZXZpc2lvbihqc29uOiBQYWNrYWdlKTogUGFja2FnZSB7XG4gICAgLy8gY2FsY3VsYXRlIHJldmlzaW9uIGZyb20gY291Y2ggZGJcbiAgICBpZiAoXy5pc1N0cmluZyhqc29uLl9yZXYpID09PSBmYWxzZSkge1xuICAgICAganNvbi5fcmV2ID0gU1RPUkFHRS5ERUZBVUxUX1JFVklTSU9OO1xuICAgIH1cblxuICAgIC8vIHRoaXMgaXMgaW50ZW5kZWQgaW4gZGVidWcgbW9kZSB3ZSBkbyBub3Qgd2FudCBtb2RpZnkgdGhlIHN0b3JlIHJldmlzaW9uXG4gICAgaWYgKF8uaXNOaWwodGhpcy5jb25maWcuX2RlYnVnKSkge1xuICAgICAganNvbi5fcmV2ID0gZ2VuZXJhdGVSZXZpc2lvbihqc29uLl9yZXYpO1xuICAgIH1cblxuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgcHJpdmF0ZSBfZGVsZXRlQXR0YWNobWVudHMoc3RvcmFnZTogYW55LCBhdHRhY2htZW50czogc3RyaW5nW10sIGNhbGxiYWNrOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGRlYnVnKCdbc3RvcmFnZS9fZGVsZXRlQXR0YWNobWVudHNdIGRlbGV0ZSBhdHRhY2htZW50cyB0b3RhbDogJW8nLCBhdHRhY2htZW50cz8ubGVuZ3RoKTtcbiAgICBjb25zdCB1bmxpbmtOZXh0ID0gZnVuY3Rpb24gKGNiKTogdm9pZCB7XG4gICAgICBpZiAoXy5pc0VtcHR5KGF0dGFjaG1lbnRzKSkge1xuICAgICAgICByZXR1cm4gY2IoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXR0YWNobWVudCA9IGF0dGFjaG1lbnRzLnNoaWZ0KCk7XG4gICAgICBzdG9yYWdlLmRlbGV0ZVBhY2thZ2UoYXR0YWNobWVudCwgZnVuY3Rpb24gKCk6IHZvaWQge1xuICAgICAgICB1bmxpbmtOZXh0KGNiKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB1bmxpbmtOZXh0KGZ1bmN0aW9uICgpOiB2b2lkIHtcbiAgICAgIC8vIHRyeSB0byB1bmxpbmsgdGhlIGRpcmVjdG9yeSwgYnV0IGlnbm9yZSBlcnJvcnMgYmVjYXVzZSBpdCBjYW4gZmFpbFxuICAgICAgc3RvcmFnZS5yZW1vdmVQYWNrYWdlKGZ1bmN0aW9uIChlcnIpOiB2b2lkIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuc3VyZSB0aGUgZGlzdCBmaWxlIHJlbWFpbnMgYXMgdGhlIHNhbWUgcHJvdG9jb2xcbiAgICogQHBhcmFtIHtPYmplY3R9IGhhc2ggbWV0YWRhdGFcbiAgICogQHBhcmFtIHtTdHJpbmd9IHVwTGlua0tleSByZWdpc3RyeSBrZXlcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgX3VwZGF0ZVVwbGlua1RvUmVtb3RlUHJvdG9jb2woaGFzaDogRGlzdEZpbGUsIHVwTGlua0tleTogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gaWYgd2UgZ290IHRoaXMgaW5mb3JtYXRpb24gZnJvbSBhIGtub3duIHJlZ2lzdHJ5LFxuICAgIC8vIHVzZSB0aGUgc2FtZSBwcm90b2NvbCBmb3IgdGhlIHRhcmJhbGxcbiAgICAvL1xuICAgIC8vIHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmxpZHdrYS9zaW5vcGlhL2lzc3Vlcy8xNjZcbiAgICBjb25zdCB0YXJiYWxsVXJsOiBhbnkgPSBVcmxOb2RlLnBhcnNlKGhhc2gudXJsKTtcbiAgICBjb25zdCB1cGxpbmtVcmw6IGFueSA9IFVybE5vZGUucGFyc2UodGhpcy5jb25maWcudXBsaW5rc1t1cExpbmtLZXldLnVybCk7XG5cbiAgICBpZiAodXBsaW5rVXJsLmhvc3QgPT09IHRhcmJhbGxVcmwuaG9zdCkge1xuICAgICAgdGFyYmFsbFVybC5wcm90b2NvbCA9IHVwbGlua1VybC5wcm90b2NvbDtcbiAgICAgIGhhc2gucmVnaXN0cnkgPSB1cExpbmtLZXk7XG4gICAgICBoYXNoLnVybCA9IFVybE5vZGUuZm9ybWF0KHRhcmJhbGxVcmwpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRTZWNyZXQoY29uZmlnOiBDb25maWcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHNlY3JldEtleSA9IGF3YWl0IHRoaXMuc3RvcmFnZVBsdWdpbi5nZXRTZWNyZXQoKTtcblxuICAgIHJldHVybiB0aGlzLnN0b3JhZ2VQbHVnaW4uc2V0U2VjcmV0KGNvbmZpZy5jaGVja1NlY3JldEtleShzZWNyZXRLZXkpKTtcbiAgfVxuXG4gIHByaXZhdGUgX2xvYWRTdG9yYWdlKGNvbmZpZzogQ29uZmlnLCBsb2dnZXI6IExvZ2dlcik6IFN0b3JhZ2VQbHVnaW4ge1xuICAgIGNvbnN0IFN0b3JhZ2UgPSB0aGlzLl9sb2FkU3RvcmVQbHVnaW4oKTtcblxuICAgIGlmIChfLmlzTmlsKFN0b3JhZ2UpKSB7XG4gICAgICBhc3NlcnQodGhpcy5jb25maWcuc3RvcmFnZSwgJ0NPTkZJRzogc3RvcmFnZSBkZWZhdWx0IHBhdGggbm90IGRlZmluZWQnKTtcbiAgICAgIHJldHVybiBuZXcgTG9jYWxEYXRhYmFzZSh0aGlzLmNvbmZpZywgbG9nZ2VyKTtcbiAgICB9XG4gICAgcmV0dXJuIFN0b3JhZ2UgYXMgU3RvcmFnZVBsdWdpbjtcbiAgfVxuXG4gIHByaXZhdGUgX2xvYWRTdG9yZVBsdWdpbigpOiBTdG9yYWdlUGx1Z2luIHwgdm9pZCB7XG4gICAgY29uc3QgcGx1Z2luX3BhcmFtcyA9IHtcbiAgICAgIGNvbmZpZzogdGhpcy5jb25maWcsXG4gICAgICBsb2dnZXI6IHRoaXMubG9nZ2VyLFxuICAgIH07XG5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgIGNvbnN0IHBsdWdpbnM6IFN0b3JhZ2VQbHVnaW5bXSA9IGxvYWRQbHVnaW48U3RvcmFnZVBsdWdpbj4oXG4gICAgICB0aGlzLmNvbmZpZyxcbiAgICAgIHRoaXMuY29uZmlnLnN0b3JlLFxuICAgICAgcGx1Z2luX3BhcmFtcyxcbiAgICAgIChwbHVnaW4pOiBTdG9yYWdlUGx1Z2luID0+IHtcbiAgICAgICAgcmV0dXJuIHBsdWdpbi5nZXRQYWNrYWdlU3RvcmFnZTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcmV0dXJuIF8uaGVhZChwbHVnaW5zKTtcbiAgfVxuXG4gIHB1YmxpYyBzYXZlVG9rZW4odG9rZW46IFRva2VuKTogUHJvbWlzZTxhbnk+IHtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKHRoaXMuc3RvcmFnZVBsdWdpbi5zYXZlVG9rZW4pID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KFxuICAgICAgICBFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5TRVJWSUNFX1VOQVZBSUxBQkxFLCBTVVBQT1JUX0VSUk9SUy5QTFVHSU5fTUlTU0lOR19JTlRFUkZBQ0UpXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnN0b3JhZ2VQbHVnaW4uc2F2ZVRva2VuKHRva2VuKTtcbiAgfVxuXG4gIHB1YmxpYyBkZWxldGVUb2tlbih1c2VyOiBzdHJpbmcsIHRva2VuS2V5OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIGlmIChfLmlzRnVuY3Rpb24odGhpcy5zdG9yYWdlUGx1Z2luLmRlbGV0ZVRva2VuKSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgRXJyb3JDb2RlLmdldENvZGUoSFRUUF9TVEFUVVMuU0VSVklDRV9VTkFWQUlMQUJMRSwgU1VQUE9SVF9FUlJPUlMuUExVR0lOX01JU1NJTkdfSU5URVJGQUNFKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zdG9yYWdlUGx1Z2luLmRlbGV0ZVRva2VuKHVzZXIsIHRva2VuS2V5KTtcbiAgfVxuXG4gIHB1YmxpYyByZWFkVG9rZW5zKGZpbHRlcjogVG9rZW5GaWx0ZXIpOiBQcm9taXNlPFRva2VuW10+IHtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKHRoaXMuc3RvcmFnZVBsdWdpbi5yZWFkVG9rZW5zKSA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChcbiAgICAgICAgRXJyb3JDb2RlLmdldENvZGUoSFRUUF9TVEFUVVMuU0VSVklDRV9VTkFWQUlMQUJMRSwgU1VQUE9SVF9FUlJPUlMuUExVR0lOX01JU1NJTkdfSU5URVJGQUNFKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zdG9yYWdlUGx1Z2luLnJlYWRUb2tlbnMoZmlsdGVyKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBMb2NhbFN0b3JhZ2U7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLE1BQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFHLElBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUdBLElBQUFJLGFBQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLFFBQUEsR0FBQUwsT0FBQTtBQWdCQSxJQUFBTSxNQUFBLEdBQUFOLE9BQUE7QUFRQSxJQUFBTyxhQUFBLEdBQUFSLHNCQUFBLENBQUFDLE9BQUE7QUFFQSxJQUFBUSxVQUFBLEdBQUFSLE9BQUE7QUFDQSxJQUFBUyxhQUFBLEdBQUFULE9BQUE7QUFRQSxJQUFBVSxPQUFBLEdBQUFWLE9BQUE7QUFBMEQsU0FBQUQsdUJBQUFZLEdBQUEsV0FBQUEsR0FBQSxJQUFBQSxHQUFBLENBQUFDLFVBQUEsR0FBQUQsR0FBQSxLQUFBRSxPQUFBLEVBQUFGLEdBQUE7QUFBQSxTQUFBRyxnQkFBQUgsR0FBQSxFQUFBSSxHQUFBLEVBQUFDLEtBQUEsSUFBQUQsR0FBQSxHQUFBRSxjQUFBLENBQUFGLEdBQUEsT0FBQUEsR0FBQSxJQUFBSixHQUFBLElBQUFPLE1BQUEsQ0FBQUMsY0FBQSxDQUFBUixHQUFBLEVBQUFJLEdBQUEsSUFBQUMsS0FBQSxFQUFBQSxLQUFBLEVBQUFJLFVBQUEsUUFBQUMsWUFBQSxRQUFBQyxRQUFBLG9CQUFBWCxHQUFBLENBQUFJLEdBQUEsSUFBQUMsS0FBQSxXQUFBTCxHQUFBO0FBQUEsU0FBQU0sZUFBQU0sR0FBQSxRQUFBUixHQUFBLEdBQUFTLFlBQUEsQ0FBQUQsR0FBQSwyQkFBQVIsR0FBQSxnQkFBQUEsR0FBQSxHQUFBVSxNQUFBLENBQUFWLEdBQUE7QUFBQSxTQUFBUyxhQUFBRSxLQUFBLEVBQUFDLElBQUEsZUFBQUQsS0FBQSxpQkFBQUEsS0FBQSxrQkFBQUEsS0FBQSxNQUFBRSxJQUFBLEdBQUFGLEtBQUEsQ0FBQUcsTUFBQSxDQUFBQyxXQUFBLE9BQUFGLElBQUEsS0FBQUcsU0FBQSxRQUFBQyxHQUFBLEdBQUFKLElBQUEsQ0FBQUssSUFBQSxDQUFBUCxLQUFBLEVBQUFDLElBQUEsMkJBQUFLLEdBQUEsc0JBQUFBLEdBQUEsWUFBQUUsU0FBQSw0REFBQVAsSUFBQSxnQkFBQUYsTUFBQSxHQUFBVSxNQUFBLEVBQUFULEtBQUE7QUFFMUQsTUFBTVUsS0FBSyxHQUFHLElBQUFDLGNBQVMsRUFBQyx5QkFBeUIsQ0FBQztBQUVsRDtBQUNBO0FBQ0E7QUFDQSxNQUFNQyxZQUFZLENBQUM7RUFLVkMsV0FBV0EsQ0FBQ0MsTUFBYyxFQUFFQyxNQUFjLEVBQUU7SUFBQTNCLGVBQUE7SUFBQUEsZUFBQTtJQUFBQSxlQUFBO0lBQ2pELElBQUksQ0FBQzJCLE1BQU0sR0FBR0EsTUFBTTtJQUNwQixJQUFJLENBQUNELE1BQU0sR0FBR0EsTUFBTTtJQUNwQixJQUFJLENBQUNFLGFBQWEsR0FBRyxJQUFJLENBQUNDLFlBQVksQ0FBQ0gsTUFBTSxFQUFFQyxNQUFNLENBQUM7RUFDeEQ7RUFFT0csVUFBVUEsQ0FBQ0MsSUFBWSxFQUFFQyxHQUFZLEVBQUVDLFFBQWtCLEVBQVE7SUFDdEUsTUFBTUMsT0FBWSxHQUFHLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNKLElBQUksQ0FBQztJQUVoRCxJQUFJSyxlQUFDLENBQUNDLEtBQUssQ0FBQ0gsT0FBTyxDQUFDLEVBQUU7TUFDcEIsT0FBT0QsUUFBUSxDQUFDSyxpQkFBUyxDQUFDQyxXQUFXLENBQUMsOEJBQThCLENBQUMsQ0FBQztJQUN4RTtJQUVBTCxPQUFPLENBQUNNLGFBQWEsQ0FBQ1QsSUFBSSxFQUFFLElBQUFVLHFDQUF1QixFQUFDVixJQUFJLENBQUMsRUFBR1csR0FBRyxJQUFLO01BQ2xFO01BQ0E7TUFDQSxJQUNFTixlQUFDLENBQUNPLE1BQU0sQ0FBQ0QsR0FBRyxDQUFDLEtBQUssS0FBSyxLQUN0QkEsR0FBRyxDQUFDRSxJQUFJLEtBQUtDLGtCQUFPLENBQUNDLGdCQUFnQixJQUFJSixHQUFHLENBQUNFLElBQUksS0FBS0csc0JBQVcsQ0FBQ0MsUUFBUSxDQUFDLEVBQzVFO1FBQ0EsT0FBT2YsUUFBUSxDQUFDSyxpQkFBUyxDQUFDVyxXQUFXLENBQUMsQ0FBQyxDQUFDO01BQzFDO01BRUEsTUFBTUMsTUFBTSxHQUFHLElBQUFDLHVCQUFnQixFQUFDbkIsR0FBRyxDQUFDO01BQ3BDLElBQUlJLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDYSxNQUFNLENBQUMsS0FBSyxLQUFLLElBQUlsQixHQUFHLENBQUNvQixRQUFRLENBQUNGLE1BQU0sQ0FBQyxFQUFFO1FBQ3JELE9BQU9qQixRQUFRLENBQUMsSUFBSSxFQUFFRCxHQUFHLENBQUNvQixRQUFRLENBQUNGLE1BQU0sQ0FBQyxDQUFDO01BQzdDO01BRUEsT0FBT2pCLFFBQVEsQ0FBQyxDQUFDO0lBQ25CLENBQUMsQ0FBQztFQUNKOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTb0IsYUFBYUEsQ0FBQ3RCLElBQVksRUFBRUUsUUFBa0IsRUFBUTtJQUMzRCxNQUFNQyxPQUFZLEdBQUcsSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQ0osSUFBSSxDQUFDO0lBQ2hEVCxLQUFLLENBQUMsK0JBQStCLEVBQUVTLElBQUksQ0FBQztJQUM1QyxJQUFJSyxlQUFDLENBQUNDLEtBQUssQ0FBQ0gsT0FBTyxDQUFDLEVBQUU7TUFDcEIsT0FBT0QsUUFBUSxDQUFDSyxpQkFBUyxDQUFDQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQzFDO0lBRUFMLE9BQU8sQ0FBQ29CLFdBQVcsQ0FBQ3ZCLElBQUksRUFBRSxDQUFDVyxHQUFHLEVBQUVhLElBQWEsS0FBVztNQUN0RCxJQUFJbkIsZUFBQyxDQUFDQyxLQUFLLENBQUNLLEdBQUcsQ0FBQyxLQUFLLEtBQUssRUFBRTtRQUMxQixJQUFJQSxHQUFHLENBQUNFLElBQUksS0FBS0Msa0JBQU8sQ0FBQ1csa0JBQWtCLElBQUlkLEdBQUcsQ0FBQ0UsSUFBSSxLQUFLRyxzQkFBVyxDQUFDVSxTQUFTLEVBQUU7VUFDakYsT0FBT3hCLFFBQVEsQ0FBQ0ssaUJBQVMsQ0FBQ0MsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMxQztRQUNBLE9BQU9OLFFBQVEsQ0FBQ1MsR0FBRyxDQUFDO01BQ3RCO01BRUFhLElBQUksR0FBRyxJQUFBRyw4QkFBZ0IsRUFBQ0gsSUFBSSxDQUFDO01BQzdCLElBQUksQ0FBQzNCLGFBQWEsQ0FBQytCLE1BQU0sQ0FBQzVCLElBQUksRUFBRzZCLFlBQW1CLElBQVc7UUFDN0QsSUFBSUEsWUFBWSxFQUFFO1VBQ2hCO1VBQ0EsSUFBSSxDQUFDakMsTUFBTSxDQUFDa0MsS0FBSyxDQUNmO1lBQUU5QjtVQUFLLENBQUMsRUFDUCxnRkFDSCxDQUFDO1VBQ0QsT0FBT0UsUUFBUSxDQUFDSyxpQkFBUyxDQUFDd0IsVUFBVSxDQUFDRixZQUFZLENBQUNHLE9BQU8sQ0FBQyxDQUFDO1FBQzdEO1FBRUE3QixPQUFPLENBQUM4QixhQUFhLENBQUNuQixrQkFBTyxDQUFDb0IsaUJBQWlCLEVBQUd2QixHQUFHLElBQVc7VUFDOUQsSUFBSUEsR0FBRyxFQUFFO1lBQ1AsT0FBT1QsUUFBUSxDQUFDUyxHQUFHLENBQUM7VUFDdEI7VUFDQSxNQUFNd0IsV0FBVyxHQUFHOUQsTUFBTSxDQUFDK0QsSUFBSSxDQUFDWixJQUFJLENBQUNhLFlBQVksQ0FBQztVQUVsRCxJQUFJLENBQUNDLGtCQUFrQixDQUFDbkMsT0FBTyxFQUFFZ0MsV0FBVyxFQUFFakMsUUFBUSxDQUFDO1FBQ3pELENBQUMsQ0FBQztNQUNKLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQztFQUNKOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTcUMsY0FBY0EsQ0FBQ3ZDLElBQVksRUFBRXdDLFdBQW9CLEVBQUV0QyxRQUFrQixFQUFRO0lBQ2xGLElBQUksQ0FBQ3VDLGtCQUFrQixDQUFDekMsSUFBSSxFQUFFLENBQUNXLEdBQUcsRUFBRStCLGdCQUFnQixLQUFXO01BQzdELElBQUkvQixHQUFHLEVBQUU7UUFDUCxPQUFPVCxRQUFRLENBQUNTLEdBQUcsQ0FBQztNQUN0QjtNQUVBLElBQUlnQyxNQUFNLEdBQUcsS0FBSztNQUNsQjtNQUNBRCxnQkFBZ0IsQ0FBQ0UsTUFBTSxHQUFHLElBQUFDLDZCQUFlLEVBQUNMLFdBQVcsQ0FBQztNQUN0RCxJQUFJQSxXQUFXLENBQUNJLE1BQU0sS0FBS0YsZ0JBQWdCLENBQUNFLE1BQU0sRUFBRTtRQUNsREQsTUFBTSxHQUFHLElBQUk7TUFDZjtNQUNBLEtBQUssTUFBTUcsU0FBUyxJQUFJTixXQUFXLENBQUNuQixRQUFRLEVBQUU7UUFDNUMsSUFBSWhCLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDb0MsZ0JBQWdCLENBQUNyQixRQUFRLENBQUN5QixTQUFTLENBQUMsQ0FBQyxFQUFFO1VBQ2pELElBQUlDLE9BQU8sR0FBR1AsV0FBVyxDQUFDbkIsUUFBUSxDQUFDeUIsU0FBUyxDQUFDOztVQUU3QztVQUNBO1VBQ0FDLE9BQU8sR0FBRyxJQUFBQywyQkFBYSxFQUFDRCxPQUFPLENBQUM7VUFDaENBLE9BQU8sQ0FBQ0UsWUFBWSxHQUFHLElBQUFDLDRCQUFxQixFQUFDSCxPQUFPLENBQUNFLFlBQXdCLENBQUM7VUFFOUVOLE1BQU0sR0FBRyxJQUFJO1VBQ2JELGdCQUFnQixDQUFDckIsUUFBUSxDQUFDeUIsU0FBUyxDQUFDLEdBQUdDLE9BQU87VUFFOUMsSUFBSUEsT0FBTyxDQUFDSSxJQUFJLElBQUlKLE9BQU8sQ0FBQ0ksSUFBSSxDQUFDQyxPQUFPLEVBQUU7WUFDeEMsTUFBTUMsU0FBYyxHQUFHQyxZQUFPLENBQUNDLEtBQUssQ0FBQ1IsT0FBTyxDQUFDSSxJQUFJLENBQUNDLE9BQU8sQ0FBQztZQUMxRCxNQUFNSSxRQUFRLEdBQUdILFNBQVMsQ0FBQ0ksUUFBUSxDQUFDQyxPQUFPLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQzs7WUFFeEQ7WUFDQSxJQUFJckQsZUFBQyxDQUFDQyxLQUFLLENBQUNvQyxnQkFBZ0IsQ0FBQ2lCLFVBQVUsQ0FBQ0gsUUFBUSxDQUFDLENBQUMsRUFBRTtjQUNsRCxNQUFNSSxJQUFjLEdBQUlsQixnQkFBZ0IsQ0FBQ2lCLFVBQVUsQ0FBQ0gsUUFBUSxDQUFDLEdBQUc7Z0JBQzlESyxHQUFHLEVBQUVkLE9BQU8sQ0FBQ0ksSUFBSSxDQUFDQyxPQUFPO2dCQUN6QlUsR0FBRyxFQUFFZixPQUFPLENBQUNJLElBQUksQ0FBQ1k7Y0FDcEIsQ0FBRTtjQUNGO2NBQ0EsTUFBTUMsTUFBYyxHQUFHakIsT0FBTyxDQUFDL0QsTUFBTSxDQUFDaUYsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7Y0FFaEUsSUFBSTVELGVBQUMsQ0FBQ0MsS0FBSyxDQUFDMEQsTUFBTSxDQUFDLEtBQUssS0FBSyxFQUFFO2dCQUM3QixJQUFJLENBQUNFLDZCQUE2QixDQUFDTixJQUFJLEVBQUVJLE1BQU0sQ0FBQztjQUNsRDtZQUNGO1VBQ0Y7UUFDRjtNQUNGO01BRUEsS0FBSyxNQUFNRyxHQUFHLElBQUkzQixXQUFXLENBQUM0QixvQkFBUyxDQUFDLEVBQUU7UUFDeEMsSUFDRSxDQUFDMUIsZ0JBQWdCLENBQUMwQixvQkFBUyxDQUFDLENBQUNELEdBQUcsQ0FBQyxJQUNqQ3pCLGdCQUFnQixDQUFDMEIsb0JBQVMsQ0FBQyxDQUFDRCxHQUFHLENBQUMsS0FBSzNCLFdBQVcsQ0FBQzRCLG9CQUFTLENBQUMsQ0FBQ0QsR0FBRyxDQUFDLEVBQ2hFO1VBQ0F4QixNQUFNLEdBQUcsSUFBSTtVQUNiRCxnQkFBZ0IsQ0FBQzBCLG9CQUFTLENBQUMsQ0FBQ0QsR0FBRyxDQUFDLEdBQUczQixXQUFXLENBQUM0QixvQkFBUyxDQUFDLENBQUNELEdBQUcsQ0FBQztRQUNoRTtNQUNGO01BRUEsS0FBSyxNQUFNRSxFQUFFLElBQUk3QixXQUFXLENBQUM4QixRQUFRLEVBQUU7UUFDckMsSUFBSWpHLE1BQU0sQ0FBQ2tHLFNBQVMsQ0FBQ0MsY0FBYyxDQUFDcEYsSUFBSSxDQUFDb0QsV0FBVyxDQUFDOEIsUUFBUSxFQUFFRCxFQUFFLENBQUMsRUFBRTtVQUNsRSxNQUFNSSxXQUFXLEdBQ2YsQ0FBQyxJQUFBQyxnQkFBUSxFQUFDaEMsZ0JBQWdCLENBQUM0QixRQUFRLENBQUNELEVBQUUsQ0FBQyxDQUFDLElBQ3hDN0IsV0FBVyxDQUFDOEIsUUFBUSxDQUFDRCxFQUFFLENBQUMsQ0FBQ00sSUFBSSxLQUFLakMsZ0JBQWdCLENBQUM0QixRQUFRLENBQUNELEVBQUUsQ0FBQyxDQUFDTSxJQUFJLElBQ3BFbkMsV0FBVyxDQUFDOEIsUUFBUSxDQUFDRCxFQUFFLENBQUMsQ0FBQ08sT0FBTyxLQUFLbEMsZ0JBQWdCLENBQUM0QixRQUFRLENBQUNELEVBQUUsQ0FBQyxDQUFDTyxPQUFPO1VBRTVFLElBQUlILFdBQVcsRUFBRTtZQUNmOUIsTUFBTSxHQUFHLElBQUk7WUFDYkQsZ0JBQWdCLENBQUM0QixRQUFRLENBQUNELEVBQUUsQ0FBQyxHQUFHN0IsV0FBVyxDQUFDOEIsUUFBUSxDQUFDRCxFQUFFLENBQUM7VUFDMUQ7UUFDRjtNQUNGO01BRUEsSUFBSSxNQUFNLElBQUk3QixXQUFXLElBQUksQ0FBQ25DLGVBQUMsQ0FBQ3dFLE9BQU8sQ0FBQ25DLGdCQUFnQixDQUFDb0MsSUFBSSxFQUFFdEMsV0FBVyxDQUFDc0MsSUFBSSxDQUFDLEVBQUU7UUFDaEZwQyxnQkFBZ0IsQ0FBQ29DLElBQUksR0FBR3RDLFdBQVcsQ0FBQ3NDLElBQUk7UUFDeENuQyxNQUFNLEdBQUcsSUFBSTtNQUNmO01BRUEsSUFBSUEsTUFBTSxFQUFFO1FBQ1ZwRCxLQUFLLENBQUMsMEJBQTBCLEVBQUVTLElBQUksQ0FBQztRQUN2QyxJQUFJLENBQUMrRSxhQUFhLENBQUMvRSxJQUFJLEVBQUUwQyxnQkFBZ0IsRUFBRSxVQUFVL0IsR0FBRyxFQUFRO1VBQzlEVCxRQUFRLENBQUNTLEdBQUcsRUFBRStCLGdCQUFnQixDQUFDO1FBQ2pDLENBQUMsQ0FBQztNQUNKLENBQUMsTUFBTTtRQUNMeEMsUUFBUSxDQUFDLElBQUksRUFBRXdDLGdCQUFnQixDQUFDO01BQ2xDO0lBQ0YsQ0FBQyxDQUFDO0VBQ0o7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTc0MsVUFBVUEsQ0FDZmhGLElBQVksRUFDWitDLE9BQWUsRUFDZmtDLFFBQWlCLEVBQ2pCZCxHQUFnQixFQUNoQmpFLFFBQWtCLEVBQ1o7SUFDTixJQUFJLENBQUNnRixjQUFjLENBQ2pCbEYsSUFBSSxFQUNKLENBQUN3QixJQUFJLEVBQUUyRCxFQUFZLEtBQVc7TUFDNUI7TUFDQTNELElBQUksQ0FBQ29CLE1BQU0sR0FBR3FDLFFBQVEsQ0FBQ3JDLE1BQU07O01BRTdCO01BQ0FxQyxRQUFRLEdBQUcsSUFBQWpDLDJCQUFhLEVBQUNpQyxRQUFRLENBQUM7TUFDbENBLFFBQVEsQ0FBQ2hDLFlBQVksR0FBRyxJQUFBQyw0QkFBcUIsRUFBQytCLFFBQVEsQ0FBQ2hDLFlBQXdCLENBQUM7TUFFaEYsTUFBTW1DLFVBQVUsR0FBRzVELElBQUksQ0FBQ0gsUUFBUSxDQUFDMEIsT0FBTyxDQUFDLElBQUksSUFBSTtNQUNqRCxJQUFJcUMsVUFBVSxFQUFFO1FBQ2QsT0FBT0QsRUFBRSxDQUFDNUUsaUJBQVMsQ0FBQ1csV0FBVyxDQUFDLENBQUMsQ0FBQztNQUNwQzs7TUFFQTtNQUNBLElBQUksSUFBQXdELGdCQUFRLEVBQUNPLFFBQVEsQ0FBQzlCLElBQUksQ0FBQyxJQUFJOUMsZUFBQyxDQUFDZ0YsUUFBUSxDQUFDSixRQUFRLENBQUM5QixJQUFJLENBQUNDLE9BQU8sQ0FBQyxFQUFFO1FBQ2hFLE1BQU1BLE9BQU8sR0FBRzZCLFFBQVEsQ0FBQzlCLElBQUksQ0FBQ0MsT0FBTyxDQUFDTSxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQztRQUV6RCxJQUFJLElBQUFnQixnQkFBUSxFQUFDbEQsSUFBSSxDQUFDYSxZQUFZLENBQUNlLE9BQU8sQ0FBQyxDQUFDLEVBQUU7VUFDeEMsSUFDRS9DLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDa0IsSUFBSSxDQUFDYSxZQUFZLENBQUNlLE9BQU8sQ0FBQyxDQUFDVyxNQUFNLENBQUMsS0FBSyxLQUFLLElBQ3BEMUQsZUFBQyxDQUFDQyxLQUFLLENBQUMyRSxRQUFRLENBQUM5QixJQUFJLENBQUNZLE1BQU0sQ0FBQyxLQUFLLEtBQUssRUFDdkM7WUFDQSxJQUFJdkMsSUFBSSxDQUFDYSxZQUFZLENBQUNlLE9BQU8sQ0FBQyxDQUFDVyxNQUFNLElBQUlrQixRQUFRLENBQUM5QixJQUFJLENBQUNZLE1BQU0sRUFBRTtjQUM3RCxNQUFNdUIsWUFBWSxHQUFJLGlCQUFnQjlELElBQUksQ0FBQ2EsWUFBWSxDQUFDZSxPQUFPLENBQUMsQ0FBQ1csTUFBTyxPQUFNa0IsUUFBUSxDQUFDOUIsSUFBSSxDQUFDWSxNQUFPLEVBQUM7Y0FDcEcsT0FBT29CLEVBQUUsQ0FBQzVFLGlCQUFTLENBQUNnRixhQUFhLENBQUNELFlBQVksQ0FBQyxDQUFDO1lBQ2xEO1VBQ0Y7VUFFQSxNQUFNRSxXQUFXLEdBQUcsSUFBSUMsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7O1VBRTVDO1VBQ0EsSUFBSXJGLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDa0IsSUFBSSxDQUFDc0QsSUFBSSxDQUFDLEVBQUU7WUFDdEJ0RCxJQUFJLENBQUNzRCxJQUFJLEdBQUcsQ0FBQyxDQUFDO1VBQ2hCO1VBRUF0RCxJQUFJLENBQUNzRCxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUdVLFdBQVc7VUFFbkMsSUFBSSxTQUFTLElBQUloRSxJQUFJLENBQUNzRCxJQUFJLEtBQUssS0FBSyxFQUFFO1lBQ3BDdEQsSUFBSSxDQUFDc0QsSUFBSSxDQUFDYSxPQUFPLEdBQUdILFdBQVc7VUFDakM7VUFFQWhFLElBQUksQ0FBQ3NELElBQUksQ0FBQy9CLE9BQU8sQ0FBQyxHQUFHeUMsV0FBVztVQUNoQ2hFLElBQUksQ0FBQ2EsWUFBWSxDQUFDZSxPQUFPLENBQUMsQ0FBQ0wsT0FBTyxHQUFHQSxPQUFPO1FBQzlDO01BQ0Y7TUFFQXZCLElBQUksQ0FBQ0gsUUFBUSxDQUFDMEIsT0FBTyxDQUFDLEdBQUdrQyxRQUFRO01BQ2pDLElBQUFXLGtCQUFVLEVBQUNwRSxJQUFJLEVBQUV1QixPQUFPLEVBQUVvQixHQUFHLENBQUM7TUFFOUIsSUFBSSxDQUFDdEUsYUFBYSxDQUFDZ0csR0FBRyxDQUFDN0YsSUFBSSxFQUFHOEYsU0FBUyxJQUFXO1FBQ2hELElBQUlBLFNBQVMsRUFBRTtVQUNiLE9BQU9YLEVBQUUsQ0FBQzVFLGlCQUFTLENBQUN3QixVQUFVLENBQUMrRCxTQUFTLENBQUM5RCxPQUFPLENBQUMsQ0FBQztRQUNwRDtRQUVBbUQsRUFBRSxDQUFDLENBQUM7TUFDTixDQUFDLENBQUM7SUFDSixDQUFDLEVBQ0RqRixRQUNGLENBQUM7RUFDSDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDUzZGLFNBQVNBLENBQUNDLE9BQWUsRUFBRUMsSUFBZSxFQUFFL0YsUUFBa0IsRUFBUTtJQUMzRSxJQUFJLENBQUNnRixjQUFjLENBQ2pCYyxPQUFPLEVBQ1AsQ0FBQ3hFLElBQUksRUFBRTJELEVBQUUsS0FBVztNQUNsQjtNQUNBLEtBQUssTUFBTWhCLEdBQUcsSUFBSThCLElBQUksRUFBRTtRQUN0QjtRQUNBLElBQUk1RixlQUFDLENBQUNPLE1BQU0sQ0FBQ3FGLElBQUksQ0FBQzlCLEdBQUcsQ0FBQyxDQUFDLEVBQUU7VUFDdkIsT0FBTzNDLElBQUksQ0FBQzRDLG9CQUFTLENBQUMsQ0FBQ0QsR0FBRyxDQUFDO1VBQzNCO1FBQ0Y7UUFFQSxJQUFJOUQsZUFBQyxDQUFDQyxLQUFLLENBQUNrQixJQUFJLENBQUNILFFBQVEsQ0FBQzRFLElBQUksQ0FBQzlCLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtVQUNyQyxPQUFPZ0IsRUFBRSxDQUFDLElBQUksQ0FBQ2UsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDO1FBQ0EsTUFBTW5ELE9BQWUsR0FBR2tELElBQUksQ0FBQzlCLEdBQUcsQ0FBQztRQUNqQyxJQUFBeUIsa0JBQVUsRUFBQ3BFLElBQUksRUFBRXVCLE9BQU8sRUFBRW9CLEdBQUcsQ0FBQztNQUNoQztNQUNBZ0IsRUFBRSxDQUFDLElBQUksQ0FBQztJQUNWLENBQUMsRUFDRGpGLFFBQ0YsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7RUFDVWdHLG1CQUFtQkEsQ0FBQSxFQUFRO0lBQ2pDLE9BQU8zRixpQkFBUyxDQUFDQyxXQUFXLENBQUMyRixvQkFBUyxDQUFDQyxpQkFBaUIsQ0FBQztFQUMzRDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1VDLG9CQUFvQkEsQ0FBQSxFQUFRO0lBQ2xDLE9BQU85RixpQkFBUyxDQUFDQyxXQUFXLENBQUMsd0JBQXdCLENBQUM7RUFDeEQ7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1M4RixhQUFhQSxDQUNsQnRHLElBQVksRUFDWnVHLFdBQW9CLEVBQ3BCQyxRQUF1QixFQUN2QnRHLFFBQWtCLEVBQ1o7SUFDTixJQUFJLENBQUMsSUFBQXdFLGdCQUFRLEVBQUM2QixXQUFXLENBQUNsRixRQUFRLENBQUMsSUFBSSxDQUFDLElBQUFxRCxnQkFBUSxFQUFDNkIsV0FBVyxDQUFDbkMsb0JBQVMsQ0FBQyxDQUFDLEVBQUU7TUFDeEUsSUFBSSxDQUFDeEUsTUFBTSxDQUFDa0MsS0FBSyxDQUFDO1FBQUU5QjtNQUFLLENBQUMsRUFBRyxvQ0FBbUMsQ0FBQztNQUNqRSxPQUFPRSxRQUFRLENBQUNLLGlCQUFTLENBQUN3QixVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQ3pDO0lBQ0F4QyxLQUFLLENBQUMsdUNBQXVDLEVBQUVTLElBQUksQ0FBQztJQUNwRCxJQUFJLENBQUNrRixjQUFjLENBQ2pCbEYsSUFBSSxFQUNKLENBQUN5RyxTQUFrQixFQUFFdEIsRUFBWSxLQUFXO01BQzFDLEtBQUssTUFBTXBDLE9BQU8sSUFBSTBELFNBQVMsQ0FBQ3BGLFFBQVEsRUFBRTtRQUN4QyxNQUFNcUYsZUFBZSxHQUFHSCxXQUFXLENBQUNsRixRQUFRLENBQUMwQixPQUFPLENBQUM7UUFDckQsSUFBSTFDLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDb0csZUFBZSxDQUFDLEVBQUU7VUFDNUIsSUFBSSxDQUFDOUcsTUFBTSxDQUFDK0csSUFBSSxDQUFDO1lBQUUzRyxJQUFJLEVBQUVBLElBQUk7WUFBRStDLE9BQU8sRUFBRUE7VUFBUSxDQUFDLEVBQUUsaUNBQWlDLENBQUM7O1VBRXJGO1VBQ0EsT0FBTzBELFNBQVMsQ0FBQ3BGLFFBQVEsQ0FBQzBCLE9BQU8sQ0FBQztVQUNsQyxPQUFPMEQsU0FBUyxDQUFDM0IsSUFBSSxDQUFFL0IsT0FBTyxDQUFDO1VBRS9CLEtBQUssTUFBTTZELElBQUksSUFBSUgsU0FBUyxDQUFDcEUsWUFBWSxFQUFFO1lBQ3pDLElBQUlvRSxTQUFTLENBQUNwRSxZQUFZLENBQUN1RSxJQUFJLENBQUMsQ0FBQzdELE9BQU8sS0FBS0EsT0FBTyxFQUFFO2NBQ3BELE9BQU8wRCxTQUFTLENBQUNwRSxZQUFZLENBQUN1RSxJQUFJLENBQUMsQ0FBQzdELE9BQU87WUFDN0M7VUFDRjtRQUNGLENBQUMsTUFBTSxJQUFJMUUsTUFBTSxDQUFDa0csU0FBUyxDQUFDQyxjQUFjLENBQUNwRixJQUFJLENBQUNzSCxlQUFlLEVBQUUsWUFBWSxDQUFDLEVBQUU7VUFDOUUsTUFBTUcsa0JBQWtCLEdBQUdILGVBQWUsQ0FBQ0ksVUFBVTtVQUNyRCxJQUFJRCxrQkFBa0IsSUFBSUosU0FBUyxDQUFDcEYsUUFBUSxDQUFDMEIsT0FBTyxDQUFDLENBQUMrRCxVQUFVLEVBQUU7WUFDaEUsSUFBSSxDQUFDRCxrQkFBa0IsRUFBRTtjQUN2QixJQUFJLENBQUNqSCxNQUFNLENBQUMrRyxJQUFJLENBQ2Q7Z0JBQUUzRyxJQUFJLEVBQUVBLElBQUk7Z0JBQUUrQyxPQUFPLEVBQUVBO2NBQVEsQ0FBQyxFQUNoQyxrQ0FDRixDQUFDO2NBQ0QsT0FBTzBELFNBQVMsQ0FBQ3BGLFFBQVEsQ0FBQzBCLE9BQU8sQ0FBQyxDQUFDK0QsVUFBVTtZQUMvQyxDQUFDLE1BQU07Y0FDTCxJQUFJLENBQUNsSCxNQUFNLENBQUMrRyxJQUFJLENBQ2Q7Z0JBQUUzRyxJQUFJLEVBQUVBLElBQUk7Z0JBQUUrQyxPQUFPLEVBQUVBO2NBQVEsQ0FBQyxFQUNoQyxnQ0FDRixDQUFDO2NBQ0QwRCxTQUFTLENBQUNwRixRQUFRLENBQUMwQixPQUFPLENBQUMsQ0FBQytELFVBQVUsR0FBR0Qsa0JBQWtCO1lBQzdEO1lBQ0FKLFNBQVMsQ0FBQzNCLElBQUksQ0FBRWlDLFFBQVEsR0FBRyxJQUFJdEIsSUFBSSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7VUFDckQ7UUFDRjtNQUNGO01BRUFlLFNBQVMsQ0FBQ08sZ0JBQUssQ0FBQyxHQUFHVCxXQUFXLENBQUNTLGdCQUFLLENBQUM7TUFDckNQLFNBQVMsQ0FBQ3JDLG9CQUFTLENBQUMsR0FBR21DLFdBQVcsQ0FBQ25DLG9CQUFTLENBQUM7TUFDN0NlLEVBQUUsQ0FBQyxJQUFJLENBQUM7SUFDVixDQUFDLEVBQ0QsVUFBVXhFLEdBQUcsRUFBUTtNQUNuQixJQUFJQSxHQUFHLEVBQUU7UUFDUCxPQUFPVCxRQUFRLENBQUNTLEdBQUcsQ0FBQztNQUN0QjtNQUNBVCxRQUFRLENBQUMsQ0FBQztJQUNaLENBQ0YsQ0FBQztFQUNIO0VBQ0E7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDUytHLGFBQWFBLENBQUNqSCxJQUFZLEVBQUV3RCxRQUFnQixFQUFFZ0QsUUFBZ0IsRUFBRXRHLFFBQWtCLEVBQVE7SUFDL0YsSUFBQWdILGVBQU0sRUFBQyxJQUFBQyxtQkFBWSxFQUFDM0QsUUFBUSxDQUFDLENBQUM7SUFFOUIsSUFBSSxDQUFDMEIsY0FBYyxDQUNqQmxGLElBQUksRUFDSixDQUFDd0IsSUFBSSxFQUFFMkQsRUFBRSxLQUFXO01BQ2xCLElBQUkzRCxJQUFJLENBQUNhLFlBQVksQ0FBQ21CLFFBQVEsQ0FBQyxFQUFFO1FBQy9CLE9BQU9oQyxJQUFJLENBQUNhLFlBQVksQ0FBQ21CLFFBQVEsQ0FBQztRQUNsQzJCLEVBQUUsQ0FBQyxJQUFJLENBQUM7TUFDVixDQUFDLE1BQU07UUFDTEEsRUFBRSxDQUFDLElBQUksQ0FBQ2tCLG9CQUFvQixDQUFDLENBQUMsQ0FBQztNQUNqQztJQUNGLENBQUMsRUFDQTFGLEdBQVEsSUFBVztNQUNsQixJQUFJQSxHQUFHLEVBQUU7UUFDUCxPQUFPVCxRQUFRLENBQUNTLEdBQUcsQ0FBQztNQUN0QjtNQUNBLE1BQU1SLE9BQU8sR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7TUFFM0MsSUFBSUcsT0FBTyxFQUFFO1FBQ1hBLE9BQU8sQ0FBQzhCLGFBQWEsQ0FBQ3VCLFFBQVEsRUFBRXRELFFBQVEsQ0FBQztNQUMzQztJQUNGLENBQ0YsQ0FBQztFQUNIOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTa0gsVUFBVUEsQ0FBQ3BILElBQVksRUFBRXdELFFBQWdCLEVBQUU7SUFDaEQsSUFBQTBELGVBQU0sRUFBQyxJQUFBQyxtQkFBWSxFQUFDM0QsUUFBUSxDQUFDLENBQUM7SUFFOUIsSUFBSTZELE1BQU0sR0FBRyxDQUFDO0lBQ2QsTUFBTUMsVUFBVSxHQUFHLElBQUFDLHdCQUFpQixFQUFDLENBQUM7SUFDdEMsTUFBTUMsWUFBWSxHQUFHLElBQUlDLHNCQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDMUMsTUFBTUMsVUFBVSxHQUFHRixZQUFZLENBQUNFLFVBQVU7SUFDMUMsTUFBTXZILE9BQU8sR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7SUFFM0N3SCxZQUFZLENBQUNHLEtBQUssR0FBRyxZQUFrQixDQUFDLENBQUM7SUFDekNILFlBQVksQ0FBQ0ksSUFBSSxHQUFHLFlBQWtCLENBQUMsQ0FBQztJQUV4Q0osWUFBWSxDQUFDRSxVQUFVLEdBQUcsVUFBVWxHLElBQUksRUFBRSxHQUFHcUcsSUFBSSxFQUFRO01BQ3ZEUCxVQUFVLENBQUNRLE1BQU0sQ0FBQ3RHLElBQUksQ0FBQztNQUN2QjtNQUNBNkYsTUFBTSxJQUFJN0YsSUFBSSxDQUFDNkYsTUFBTTtNQUNyQixNQUFNVSxXQUFXLEdBQUcsQ0FBQ3ZHLElBQUksRUFBRSxHQUFHcUcsSUFBSSxDQUFDO01BQ25DO01BQ0E7TUFDQUgsVUFBVSxDQUFDTSxLQUFLLENBQUNSLFlBQVksRUFBRU8sV0FBVyxDQUFDO0lBQzdDLENBQUM7SUFFRCxJQUFJL0gsSUFBSSxLQUFLLFdBQVcsRUFBRTtNQUN4QmlJLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLE1BQVk7UUFDM0JWLFlBQVksQ0FBQ1csSUFBSSxDQUFDLE9BQU8sRUFBRTVILGlCQUFTLENBQUM2SCxZQUFZLENBQUMsQ0FBQyxDQUFDO01BQ3RELENBQUMsQ0FBQztNQUNGLE9BQU9aLFlBQVk7SUFDckI7SUFFQSxJQUFJLENBQUNySCxPQUFPLEVBQUU7TUFDWjhILE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLE1BQVk7UUFDM0JWLFlBQVksQ0FBQ1csSUFBSSxDQUFDLE9BQU8sRUFBRSwyQkFBMkIsQ0FBQztNQUN6RCxDQUFDLENBQUM7TUFDRixPQUFPWCxZQUFZO0lBQ3JCO0lBRUEsTUFBTWEsV0FBVyxHQUFHbEksT0FBTyxDQUFDbUksWUFBWSxDQUFDOUUsUUFBUSxDQUFDO0lBRWxENkUsV0FBVyxDQUFDRSxFQUFFLENBQUMsT0FBTyxFQUFHNUgsR0FBRyxJQUFLO01BQy9CO01BQ0EsSUFBSUEsR0FBRyxDQUFDRSxJQUFJLEtBQUtDLGtCQUFPLENBQUNDLGdCQUFnQixJQUFJSixHQUFHLENBQUNFLElBQUksS0FBS0csc0JBQVcsQ0FBQ0MsUUFBUSxFQUFFO1FBQzlFdUcsWUFBWSxDQUFDVyxJQUFJLENBQUMsT0FBTyxFQUFFNUgsaUJBQVMsQ0FBQ1csV0FBVyxDQUFDLENBQUMsQ0FBQztRQUNuRHNHLFlBQVksQ0FBQ0csS0FBSyxDQUFDLENBQUM7UUFDcEI7TUFDRixDQUFDLE1BQU0sSUFBSWhILEdBQUcsQ0FBQ0UsSUFBSSxLQUFLQyxrQkFBTyxDQUFDVyxrQkFBa0IsSUFBSWQsR0FBRyxDQUFDRSxJQUFJLEtBQUtHLHNCQUFXLENBQUNVLFNBQVMsRUFBRTtRQUN4RjtRQUNBLElBQUksQ0FBQzhHLGtCQUFrQixDQUFDeEksSUFBSSxFQUFFLFVBQVV5SSxJQUFTLEVBQUVDLElBQWEsRUFBUTtVQUN0RSxJQUFJRCxJQUFJLEVBQUU7WUFDUmpCLFlBQVksQ0FBQ1csSUFBSSxDQUFDLE9BQU8sRUFBRU0sSUFBSSxDQUFDO1VBQ2xDLENBQUMsTUFBTTtZQUNMakIsWUFBWSxDQUFDVyxJQUFJLENBQUMsT0FBTyxFQUFFeEgsR0FBRyxDQUFDO1VBQ2pDO1FBQ0YsQ0FBQyxDQUFDO01BQ0osQ0FBQyxNQUFNO1FBQ0w2RyxZQUFZLENBQUNXLElBQUksQ0FBQyxPQUFPLEVBQUV4SCxHQUFHLENBQUM7TUFDakM7SUFDRixDQUFDLENBQUM7SUFFRjBILFdBQVcsQ0FBQ0UsRUFBRSxDQUFDLE1BQU0sRUFBRSxZQUFrQjtNQUN2QztNQUNBZixZQUFZLENBQUNXLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDM0IsQ0FBQyxDQUFDO0lBRUZFLFdBQVcsQ0FBQ0UsRUFBRSxDQUFDLFNBQVMsRUFBRSxNQUFZO01BQ3BDLElBQUksQ0FBQ3JELGNBQWMsQ0FDakJsRixJQUFJLEVBQ0osU0FBUzJJLE9BQU9BLENBQUNuSCxJQUFJLEVBQUUyRCxFQUFFLEVBQVE7UUFDL0IzRCxJQUFJLENBQUNhLFlBQVksQ0FBQ21CLFFBQVEsQ0FBQyxHQUFHO1VBQzVCTyxNQUFNLEVBQUV1RCxVQUFVLENBQUNzQixNQUFNLENBQUMsS0FBSztRQUNqQyxDQUFDO1FBQ0R6RCxFQUFFLENBQUMsSUFBSSxDQUFDO01BQ1YsQ0FBQyxFQUNELFVBQVV4RSxHQUFHLEVBQVE7UUFDbkIsSUFBSUEsR0FBRyxFQUFFO1VBQ1A2RyxZQUFZLENBQUNXLElBQUksQ0FBQyxPQUFPLEVBQUV4SCxHQUFHLENBQUM7UUFDakMsQ0FBQyxNQUFNO1VBQ0w2RyxZQUFZLENBQUNXLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDOUI7TUFDRixDQUNGLENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRlgsWUFBWSxDQUFDRyxLQUFLLEdBQUcsWUFBa0I7TUFDckNVLFdBQVcsQ0FBQ1YsS0FBSyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUVESCxZQUFZLENBQUNJLElBQUksR0FBRyxZQUFrQjtNQUNwQyxJQUFJLENBQUNQLE1BQU0sRUFBRTtRQUNYRyxZQUFZLENBQUNXLElBQUksQ0FBQyxPQUFPLEVBQUU1SCxpQkFBUyxDQUFDd0IsVUFBVSxDQUFDLHFDQUFxQyxDQUFDLENBQUM7UUFDdkZzRyxXQUFXLENBQUNWLEtBQUssQ0FBQyxDQUFDO01BQ3JCLENBQUMsTUFBTTtRQUNMVSxXQUFXLENBQUNULElBQUksQ0FBQyxDQUFDO01BQ3BCO0lBQ0YsQ0FBQztJQUVESixZQUFZLENBQUNxQixJQUFJLENBQUNSLFdBQVcsQ0FBQztJQUU5QixPQUFPYixZQUFZO0VBQ3JCOztFQUVBO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNTc0IsVUFBVUEsQ0FBQzlJLElBQVksRUFBRXdELFFBQWdCLEVBQUU7SUFDaEQsSUFBQTBELGVBQU0sRUFBQyxJQUFBQyxtQkFBWSxFQUFDM0QsUUFBUSxDQUFDLENBQUM7SUFFOUIsTUFBTXJELE9BQU8sR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7SUFFM0MsSUFBSUssZUFBQyxDQUFDQyxLQUFLLENBQUNILE9BQU8sQ0FBQyxFQUFFO01BQ3BCLE9BQU8sSUFBSSxDQUFDNEksNEJBQTRCLENBQUMsQ0FBQztJQUM1QztJQUVBLE9BQU8sSUFBSSxDQUFDQyx5QkFBeUIsQ0FBQzdJLE9BQU8sRUFBRXFELFFBQVEsQ0FBQztFQUMxRDs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0VBQ1V1Riw0QkFBNEJBLENBQUEsRUFBRztJQUNyQyxNQUFNRSxNQUFNLEdBQUcsSUFBSUMsb0JBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVsQ2pCLE9BQU8sQ0FBQ0MsUUFBUSxDQUFDLE1BQVk7TUFDM0JlLE1BQU0sQ0FBQ2QsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM5QixvQkFBb0IsQ0FBQyxDQUFDLENBQUM7SUFDbkQsQ0FBQyxDQUFDO0lBQ0YsT0FBTzRDLE1BQU07RUFDZjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNVRCx5QkFBeUJBLENBQUM3SSxPQUFZLEVBQUVxRCxRQUFnQixFQUFFO0lBQ2hFLE1BQU15RixNQUFNLEdBQUcsSUFBSUMsb0JBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQyxNQUFNQyxpQkFBaUIsR0FBR2hKLE9BQU8sQ0FBQ2lKLFdBQVcsQ0FBQzVGLFFBQVEsQ0FBQztJQUN2RCxNQUFNNkYsSUFBSSxHQUFHOUksaUJBQVMsQ0FBQ0MsV0FBVztJQUVsQ3lJLE1BQU0sQ0FBQ3RCLEtBQUssR0FBRyxZQUFrQjtNQUMvQixJQUFJdEgsZUFBQyxDQUFDQyxLQUFLLENBQUM2SSxpQkFBaUIsQ0FBQyxLQUFLLEtBQUssRUFBRTtRQUN4Q0EsaUJBQWlCLENBQUN4QixLQUFLLENBQUMsQ0FBQztNQUMzQjtJQUNGLENBQUM7SUFFRHdCLGlCQUFpQixDQUFDWixFQUFFLENBQUMsT0FBTyxFQUFFLFVBQVU1SCxHQUFHLEVBQUU7TUFDM0M7TUFDQSxJQUFJQSxHQUFHLENBQUNFLElBQUksS0FBS0Msa0JBQU8sQ0FBQ1csa0JBQWtCLElBQUlkLEdBQUcsQ0FBQ0UsSUFBSSxLQUFLRyxzQkFBVyxDQUFDVSxTQUFTLEVBQUU7UUFDakZ1SCxNQUFNLENBQUNkLElBQUksQ0FBQyxPQUFPLEVBQUVrQixJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztNQUN0RCxDQUFDLE1BQU07UUFDTEosTUFBTSxDQUFDZCxJQUFJLENBQUMsT0FBTyxFQUFFeEgsR0FBRyxDQUFDO01BQzNCO0lBQ0YsQ0FBQyxDQUFDO0lBRUZ3SSxpQkFBaUIsQ0FBQ1osRUFBRSxDQUFDLGdCQUFnQixFQUFFLFVBQVVlLE9BQU8sRUFBUTtNQUM5REwsTUFBTSxDQUFDZCxJQUFJLENBQUMsZ0JBQWdCLEVBQUVtQixPQUFPLENBQUM7SUFDeEMsQ0FBQyxDQUFDO0lBRUZILGlCQUFpQixDQUFDWixFQUFFLENBQUMsTUFBTSxFQUFFLFlBQWtCO01BQzdDO01BQ0FVLE1BQU0sQ0FBQ2QsSUFBSSxDQUFDLE1BQU0sQ0FBQztNQUNuQmdCLGlCQUFpQixDQUFDTixJQUFJLENBQUNJLE1BQU0sQ0FBQztJQUNoQyxDQUFDLENBQUM7SUFFRixPQUFPQSxNQUFNO0VBQ2Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NULGtCQUFrQkEsQ0FBQ3hJLElBQVksRUFBRUUsUUFBa0IsR0FBR0EsQ0FBQSxLQUFZLENBQUMsQ0FBQyxFQUFRO0lBQ2pGLE1BQU1DLE9BQU8sR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7SUFDM0MsSUFBSUssZUFBQyxDQUFDQyxLQUFLLENBQUNILE9BQU8sQ0FBQyxFQUFFO01BQ3BCLE9BQU9ELFFBQVEsQ0FBQ0ssaUJBQVMsQ0FBQ0MsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUMxQztJQUVBLElBQUksQ0FBQytJLFlBQVksQ0FBQ3ZKLElBQUksRUFBRUcsT0FBTyxFQUFFRCxRQUFRLENBQUM7RUFDNUM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1NzSixNQUFNQSxDQUFDQyxRQUFnQixFQUFFQyxPQUFZLEVBQUU7SUFDNUMsTUFBTVQsTUFBTSxHQUFHLElBQUlDLG9CQUFXLENBQUM7TUFBRVMsVUFBVSxFQUFFO0lBQUssQ0FBQyxDQUFDO0lBRXBELElBQUksQ0FBQ0Msa0JBQWtCLENBQ3JCLENBQUNDLElBQWEsRUFBRTFFLEVBQVksS0FBVztNQUNyQztNQUNBLElBQUkwRSxJQUFJLENBQUMvRSxJQUFJLEdBQUdnRixRQUFRLENBQUNMLFFBQVEsRUFBRSxFQUFFLENBQUMsRUFBRTtRQUN0QyxJQUFJLENBQUNqQixrQkFBa0IsQ0FBQ3FCLElBQUksQ0FBQzdKLElBQUksRUFBRSxDQUFDVyxHQUFRLEVBQUVhLElBQWEsS0FBVztVQUNwRSxJQUFJYixHQUFHLEVBQUU7WUFDUCxPQUFPd0UsRUFBRSxDQUFDeEUsR0FBRyxDQUFDO1VBQ2hCOztVQUVBO1VBQ0EsTUFBTW1FLElBQUksR0FBRyxJQUFJVyxJQUFJLENBQUNvRSxJQUFJLENBQUMvRSxJQUFJLENBQUMsQ0FBQ1ksV0FBVyxDQUFDLENBQUM7VUFDOUMsTUFBTXFFLE1BQU0sR0FBRyxJQUFBQyxrQ0FBb0IsRUFBQ3hJLElBQUksRUFBRXNELElBQUksQ0FBQztVQUMvQyxJQUFJekUsZUFBQyxDQUFDQyxLQUFLLENBQUN5SixNQUFNLENBQUMsS0FBSyxLQUFLLEVBQUU7WUFDN0JkLE1BQU0sQ0FBQ2dCLElBQUksQ0FBQ0YsTUFBTSxDQUFDO1VBQ3JCO1VBQ0E1RSxFQUFFLENBQUMsSUFBSSxDQUFDO1FBQ1YsQ0FBQyxDQUFDO01BQ0osQ0FBQyxNQUFNO1FBQ0xBLEVBQUUsQ0FBQyxJQUFJLENBQUM7TUFDVjtJQUNGLENBQUMsRUFDRCxTQUFTK0UsS0FBS0EsQ0FBQ3ZKLEdBQUcsRUFBUTtNQUN4QixJQUFJQSxHQUFHLEVBQUU7UUFDUHNJLE1BQU0sQ0FBQ2QsSUFBSSxDQUFDLE9BQU8sRUFBRXhILEdBQUcsQ0FBQztRQUN6QjtNQUNGO01BQ0FzSSxNQUFNLENBQUNrQixHQUFHLENBQUMsQ0FBQztJQUNkLENBQ0YsQ0FBQztJQUVELE9BQU9sQixNQUFNO0VBQ2Y7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNVN0ksZ0JBQWdCQSxDQUFDNEYsT0FBZSxFQUFFO0lBQ3hDLE9BQU8sSUFBSSxDQUFDbkcsYUFBYSxDQUFDdUssaUJBQWlCLENBQUNwRSxPQUFPLENBQUM7RUFDdEQ7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNVdUQsWUFBWUEsQ0FBQ3ZKLElBQVksRUFBRUcsT0FBWSxFQUFFRCxRQUFrQixFQUFRO0lBQ3pFQyxPQUFPLENBQUNvQixXQUFXLENBQUN2QixJQUFJLEVBQUUsQ0FBQ1csR0FBRyxFQUFFb0osTUFBTSxLQUFXO01BQy9DLElBQUlwSixHQUFHLEVBQUU7UUFDUCxJQUFJQSxHQUFHLENBQUNFLElBQUksS0FBS0Msa0JBQU8sQ0FBQ1csa0JBQWtCLElBQUlkLEdBQUcsQ0FBQ0UsSUFBSSxLQUFLRyxzQkFBVyxDQUFDVSxTQUFTLEVBQUU7VUFDakYsT0FBT3hCLFFBQVEsQ0FBQ0ssaUJBQVMsQ0FBQ0MsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMxQztRQUNBLE9BQU9OLFFBQVEsQ0FBQyxJQUFJLENBQUNtSyxjQUFjLENBQUMxSixHQUFHLEVBQUVHLGtCQUFPLENBQUNvQixpQkFBaUIsRUFBRSxlQUFlLENBQUMsQ0FBQztNQUN2RjtNQUVBaEMsUUFBUSxDQUFDUyxHQUFHLEVBQUUsSUFBQWdCLDhCQUFnQixFQUFDb0ksTUFBTSxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDO0VBQ0o7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtFQUNVSCxrQkFBa0JBLENBQUNVLFNBQTBCLEVBQUVKLEtBQXlCLEVBQVE7SUFDdEY7SUFDQSxJQUFJN0osZUFBQyxDQUFDQyxLQUFLLENBQUMsSUFBSSxDQUFDVCxhQUFhLENBQUMySixNQUFNLENBQUMsRUFBRTtNQUN0QyxJQUFJLENBQUM1SixNQUFNLENBQUMySyxJQUFJLENBQUMsbUNBQW1DLENBQUM7TUFDckRMLEtBQUssQ0FBQyxDQUFDO0lBQ1QsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDckssYUFBYSxDQUFDMkosTUFBTSxDQUFDYyxTQUFTLEVBQUVKLEtBQUssRUFBRS9DLG1CQUFZLENBQUM7SUFDM0Q7RUFDRjs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDVTFFLGtCQUFrQkEsQ0FBQ3VELE9BQWUsRUFBRTlGLFFBQWtCLEVBQVE7SUFDcEUsTUFBTUMsT0FBWSxHQUFHLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUM0RixPQUFPLENBQUM7SUFDbkQsSUFBSTNGLGVBQUMsQ0FBQ0MsS0FBSyxDQUFDSCxPQUFPLENBQUMsRUFBRTtNQUNwQixJQUFJLENBQUNxSyxpQkFBaUIsQ0FBQ3hFLE9BQU8sRUFBRTlGLFFBQVEsQ0FBQztNQUN6QztJQUNGO0lBRUFDLE9BQU8sQ0FBQ29CLFdBQVcsQ0FBQ3lFLE9BQU8sRUFBRSxDQUFDckYsR0FBRyxFQUFFYSxJQUFJLEtBQVc7TUFDaEQ7TUFDQSxJQUFJbkIsZUFBQyxDQUFDQyxLQUFLLENBQUNLLEdBQUcsQ0FBQyxLQUFLLEtBQUssRUFBRTtRQUMxQixJQUFJQSxHQUFHLENBQUNFLElBQUksS0FBS0Msa0JBQU8sQ0FBQ1csa0JBQWtCLElBQUlkLEdBQUcsQ0FBQ0UsSUFBSSxLQUFLRyxzQkFBVyxDQUFDVSxTQUFTLEVBQUU7VUFDakZGLElBQUksR0FBRyxJQUFBZCxxQ0FBdUIsRUFBQ3NGLE9BQU8sQ0FBQztRQUN6QyxDQUFDLE1BQU07VUFDTCxPQUFPOUYsUUFBUSxDQUFDLElBQUksQ0FBQ21LLGNBQWMsQ0FBQzFKLEdBQUcsRUFBRUcsa0JBQU8sQ0FBQ29CLGlCQUFpQixFQUFFLGVBQWUsQ0FBQyxDQUFDO1FBQ3ZGO01BQ0Y7TUFFQWhDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBQXlCLDhCQUFnQixFQUFDSCxJQUFJLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUM7RUFDSjtFQUVRZ0osaUJBQWlCQSxDQUFDeEssSUFBWSxFQUFFRSxRQUFrQixFQUFZO0lBQ3BFLE9BQU9BLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBQXlCLDhCQUFnQixFQUFDLElBQUFqQixxQ0FBdUIsRUFBQ1YsSUFBSSxDQUFDLENBQUMsQ0FBQztFQUN4RTs7RUFFQTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNVcUssY0FBY0EsQ0FBQzFKLEdBQVcsRUFBRWlHLElBQVksRUFBRTVFLE9BQWUsRUFBTztJQUN0RSxJQUFJLENBQUNwQyxNQUFNLENBQUNrQyxLQUFLLENBQUM7TUFBRW5CLEdBQUcsRUFBRUEsR0FBRztNQUFFaUcsSUFBSSxFQUFFQTtJQUFLLENBQUMsRUFBRyxHQUFFNUUsT0FBUSw0QkFBMkIsQ0FBQztJQUVuRixPQUFPekIsaUJBQVMsQ0FBQ2tLLGdCQUFnQixDQUFDLENBQUM7RUFDckM7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1V2RixjQUFjQSxDQUNwQmxGLElBQVksRUFDWjBLLGFBQW9DLEVBQ3BDeEssUUFBa0IsRUFDWjtJQUNOLE1BQU1DLE9BQU8sR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7SUFFM0MsSUFBSSxDQUFDRyxPQUFPLEVBQUU7TUFDWixPQUFPRCxRQUFRLENBQUNLLGlCQUFTLENBQUNDLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDMUM7SUFFQUwsT0FBTyxDQUFDd0ssYUFBYSxDQUNuQjNLLElBQUksRUFDSjBLLGFBQWEsRUFDYixJQUFJLENBQUMzRixhQUFhLENBQUM2RixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQzdCakosOEJBQWdCLEVBQ2hCekIsUUFDRixDQUFDO0VBQ0g7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDVTZFLGFBQWFBLENBQUMvRSxJQUFZLEVBQUU2SyxJQUFhLEVBQUUzSyxRQUFrQixFQUFRO0lBQzNFLE1BQU1DLE9BQVksR0FBRyxJQUFJLENBQUNDLGdCQUFnQixDQUFDSixJQUFJLENBQUM7SUFDaEQsSUFBSUssZUFBQyxDQUFDQyxLQUFLLENBQUNILE9BQU8sQ0FBQyxFQUFFO01BQ3BCLE9BQU9ELFFBQVEsQ0FBQyxDQUFDO0lBQ25CO0lBQ0FDLE9BQU8sQ0FBQzJLLFdBQVcsQ0FBQzlLLElBQUksRUFBRSxJQUFJLENBQUMrSyxtQkFBbUIsQ0FBQ0YsSUFBSSxDQUFDLEVBQUUzSyxRQUFRLENBQUM7RUFDckU7RUFFUTZLLG1CQUFtQkEsQ0FBQ0YsSUFBYSxFQUFXO0lBQ2xEO0lBQ0EsSUFBSXhLLGVBQUMsQ0FBQ2dGLFFBQVEsQ0FBQ3dGLElBQUksQ0FBQ0csSUFBSSxDQUFDLEtBQUssS0FBSyxFQUFFO01BQ25DSCxJQUFJLENBQUNHLElBQUksR0FBR2xLLGtCQUFPLENBQUNtSyxnQkFBZ0I7SUFDdEM7O0lBRUE7SUFDQSxJQUFJNUssZUFBQyxDQUFDQyxLQUFLLENBQUMsSUFBSSxDQUFDWCxNQUFNLENBQUN2QyxNQUFNLENBQUMsRUFBRTtNQUMvQnlOLElBQUksQ0FBQ0csSUFBSSxHQUFHLElBQUFFLDhCQUFnQixFQUFDTCxJQUFJLENBQUNHLElBQUksQ0FBQztJQUN6QztJQUVBLE9BQU9ILElBQUk7RUFDYjtFQUVRdkksa0JBQWtCQSxDQUFDbkMsT0FBWSxFQUFFZ0MsV0FBcUIsRUFBRWpDLFFBQWtCLEVBQVE7SUFDeEZYLEtBQUssQ0FBQywyREFBMkQsRUFBRTRDLFdBQVcsYUFBWEEsV0FBVyx1QkFBWEEsV0FBVyxDQUFFa0YsTUFBTSxDQUFDO0lBQ3ZGLE1BQU04RCxVQUFVLEdBQUcsU0FBQUEsQ0FBVWhHLEVBQUUsRUFBUTtNQUNyQyxJQUFJOUUsZUFBQyxDQUFDK0ssT0FBTyxDQUFDakosV0FBVyxDQUFDLEVBQUU7UUFDMUIsT0FBT2dELEVBQUUsQ0FBQyxDQUFDO01BQ2I7TUFFQSxNQUFNa0csVUFBVSxHQUFHbEosV0FBVyxDQUFDbUosS0FBSyxDQUFDLENBQUM7TUFDdENuTCxPQUFPLENBQUM4QixhQUFhLENBQUNvSixVQUFVLEVBQUUsWUFBa0I7UUFDbERGLFVBQVUsQ0FBQ2hHLEVBQUUsQ0FBQztNQUNoQixDQUFDLENBQUM7SUFDSixDQUFDO0lBRURnRyxVQUFVLENBQUMsWUFBa0I7TUFDM0I7TUFDQWhMLE9BQU8sQ0FBQ21CLGFBQWEsQ0FBQyxVQUFVWCxHQUFHLEVBQVE7UUFDekNULFFBQVEsQ0FBQ1MsR0FBRyxDQUFDO01BQ2YsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDO0VBQ0o7O0VBRUE7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ1V1RCw2QkFBNkJBLENBQUNOLElBQWMsRUFBRTJILFNBQWlCLEVBQVE7SUFDN0U7SUFDQTtJQUNBO0lBQ0E7SUFDQSxNQUFNQyxVQUFlLEdBQUdsSSxZQUFPLENBQUNDLEtBQUssQ0FBQ0ssSUFBSSxDQUFDQyxHQUFHLENBQUM7SUFDL0MsTUFBTTRILFNBQWMsR0FBR25JLFlBQU8sQ0FBQ0MsS0FBSyxDQUFDLElBQUksQ0FBQzVELE1BQU0sQ0FBQytMLE9BQU8sQ0FBQ0gsU0FBUyxDQUFDLENBQUMxSCxHQUFHLENBQUM7SUFFeEUsSUFBSTRILFNBQVMsQ0FBQ0UsSUFBSSxLQUFLSCxVQUFVLENBQUNHLElBQUksRUFBRTtNQUN0Q0gsVUFBVSxDQUFDSSxRQUFRLEdBQUdILFNBQVMsQ0FBQ0csUUFBUTtNQUN4Q2hJLElBQUksQ0FBQ2lJLFFBQVEsR0FBR04sU0FBUztNQUN6QjNILElBQUksQ0FBQ0MsR0FBRyxHQUFHUCxZQUFPLENBQUN3SSxNQUFNLENBQUNOLFVBQVUsQ0FBQztJQUN2QztFQUNGO0VBRUEsTUFBYU8sU0FBU0EsQ0FBQ3BNLE1BQWMsRUFBbUI7SUFDdEQsTUFBTXFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQ25NLGFBQWEsQ0FBQ2tNLFNBQVMsQ0FBQyxDQUFDO0lBRXRELE9BQU8sSUFBSSxDQUFDbE0sYUFBYSxDQUFDb00sU0FBUyxDQUFDdE0sTUFBTSxDQUFDdU0sY0FBYyxDQUFDRixTQUFTLENBQUMsQ0FBQztFQUN2RTtFQUVRbE0sWUFBWUEsQ0FBQ0gsTUFBYyxFQUFFQyxNQUFjLEVBQWlCO0lBQ2xFLE1BQU11TSxPQUFPLEdBQUcsSUFBSSxDQUFDQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBRXZDLElBQUkvTCxlQUFDLENBQUNDLEtBQUssQ0FBQzZMLE9BQU8sQ0FBQyxFQUFFO01BQ3BCLElBQUFqRixlQUFNLEVBQUMsSUFBSSxDQUFDdkgsTUFBTSxDQUFDUSxPQUFPLEVBQUUsMENBQTBDLENBQUM7TUFDdkUsT0FBTyxJQUFJa00scUJBQWEsQ0FBQyxJQUFJLENBQUMxTSxNQUFNLEVBQUVDLE1BQU0sQ0FBQztJQUMvQztJQUNBLE9BQU91TSxPQUFPO0VBQ2hCO0VBRVFDLGdCQUFnQkEsQ0FBQSxFQUF5QjtJQUMvQyxNQUFNRSxhQUFhLEdBQUc7TUFDcEIzTSxNQUFNLEVBQUUsSUFBSSxDQUFDQSxNQUFNO01BQ25CQyxNQUFNLEVBQUUsSUFBSSxDQUFDQTtJQUNmLENBQUM7O0lBRUQ7SUFDQSxNQUFNMk0sT0FBd0IsR0FBRyxJQUFBQyxxQkFBVSxFQUN6QyxJQUFJLENBQUM3TSxNQUFNLEVBQ1gsSUFBSSxDQUFDQSxNQUFNLENBQUM4TSxLQUFLLEVBQ2pCSCxhQUFhLEVBQ1pJLE1BQU0sSUFBb0I7TUFDekIsT0FBT0EsTUFBTSxDQUFDdEMsaUJBQWlCO0lBQ2pDLENBQ0YsQ0FBQztJQUVELE9BQU8vSixlQUFDLENBQUNzTSxJQUFJLENBQUNKLE9BQU8sQ0FBQztFQUN4QjtFQUVPSyxTQUFTQSxDQUFDQyxLQUFZLEVBQWdCO0lBQzNDLElBQUl4TSxlQUFDLENBQUN5TSxVQUFVLENBQUMsSUFBSSxDQUFDak4sYUFBYSxDQUFDK00sU0FBUyxDQUFDLEtBQUssS0FBSyxFQUFFO01BQ3hELE9BQU9HLE9BQU8sQ0FBQ0MsTUFBTSxDQUNuQnpNLGlCQUFTLENBQUMwTSxPQUFPLENBQUNqTSxzQkFBVyxDQUFDa00sbUJBQW1CLEVBQUVDLHlCQUFjLENBQUNDLHdCQUF3QixDQUM1RixDQUFDO0lBQ0g7SUFFQSxPQUFPLElBQUksQ0FBQ3ZOLGFBQWEsQ0FBQytNLFNBQVMsQ0FBQ0MsS0FBSyxDQUFDO0VBQzVDO0VBRU9RLFdBQVdBLENBQUNDLElBQVksRUFBRUMsUUFBZ0IsRUFBZ0I7SUFDL0QsSUFBSWxOLGVBQUMsQ0FBQ3lNLFVBQVUsQ0FBQyxJQUFJLENBQUNqTixhQUFhLENBQUN3TixXQUFXLENBQUMsS0FBSyxLQUFLLEVBQUU7TUFDMUQsT0FBT04sT0FBTyxDQUFDQyxNQUFNLENBQ25Cek0saUJBQVMsQ0FBQzBNLE9BQU8sQ0FBQ2pNLHNCQUFXLENBQUNrTSxtQkFBbUIsRUFBRUMseUJBQWMsQ0FBQ0Msd0JBQXdCLENBQzVGLENBQUM7SUFDSDtJQUVBLE9BQU8sSUFBSSxDQUFDdk4sYUFBYSxDQUFDd04sV0FBVyxDQUFDQyxJQUFJLEVBQUVDLFFBQVEsQ0FBQztFQUN2RDtFQUVPQyxVQUFVQSxDQUFDQyxNQUFtQixFQUFvQjtJQUN2RCxJQUFJcE4sZUFBQyxDQUFDeU0sVUFBVSxDQUFDLElBQUksQ0FBQ2pOLGFBQWEsQ0FBQzJOLFVBQVUsQ0FBQyxLQUFLLEtBQUssRUFBRTtNQUN6RCxPQUFPVCxPQUFPLENBQUNDLE1BQU0sQ0FDbkJ6TSxpQkFBUyxDQUFDME0sT0FBTyxDQUFDak0sc0JBQVcsQ0FBQ2tNLG1CQUFtQixFQUFFQyx5QkFBYyxDQUFDQyx3QkFBd0IsQ0FDNUYsQ0FBQztJQUNIO0lBRUEsT0FBTyxJQUFJLENBQUN2TixhQUFhLENBQUMyTixVQUFVLENBQUNDLE1BQU0sQ0FBQztFQUM5QztBQUNGO0FBQUMsSUFBQUMsUUFBQSxHQUFBQyxPQUFBLENBQUEzUCxPQUFBLEdBRWN5QixZQUFZIn0=